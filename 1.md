
# 履歷管理系統：多對多資料庫架構說明書 (System Logic for AI)

## 1. 架構核心概念 (Architectural Concept)

本系統設計目標是支援「**同一位學生可擁有多份履歷檔案 (resumes)**」，且每份檔案對應的「**顯示內容 (content mapping)**」可以自定義勾選（即：多份履歷可引用同一張證照，也可各別勾選不同的成績）。

為了實現此需求，系統捨棄了逗號分隔字串 (CSV in TEXT)，採用標準的 **Pivot (樞紐) + Junction (中間表)** 設計。

---

## 2. 資料表角色定義 (Table Roles)

### A. 實體與基礎表 (Primary Data)

* `resumes`: 儲存學生上傳的實體檔案（metadata、路徑、審核狀態）。
* `student_info`: 儲存學生的核心個人資料（姓名、學號 `StuID`、聯絡資訊）。
* `student_certifications`: 原始證照資料池。
* `course_grades`: 原始課程成績資料池（**注意：連結應使用 `id` 而非課程名稱**）。
* `student_languageskills`: 原始語文能力資料池。
* `absence_records`: 原始缺勤紀錄資料池。

### B. 核心樞紐表 (The Hub)

* **`resume_content_mapping`**:
* 連結 `resumes.id` 與 `student_info.StuID`。
* 這是所有多對多關聯的起點。
* **重要欄位**: `id` (主鍵), `resume_id` (FK), `stu_info_id` (FK)。



### C. 多對多關聯中間表 (Junction Tables)

這些表負責記錄「某份履歷草稿勾選了哪些內容」：

1. **`resume_cert_rel`**: 連結 `mapping_id` 與 `cert_id`。
2. **`resume_grade_rel`**: 連結 `mapping_id` 與 `grade_id`。
3. **`resume_lang_rel`**: 連結 `mapping_id` 與 `lang_skill_id`。
4. **`resume_absence_rel`**: 連結 `mapping_id` 與 `absence_id`。

---

## 3. 關鍵關聯規則 (Relationship Rules for AI)

1. **多對多機制 (Many-to-Many)**:
* 同一筆原始紀錄（如：`cert_id=260`）可以同時存在於不同的 `mapping_id` 關聯中。
* 透過 `PRIMARY KEY(mapping_id, item_id)` 確保不會重複連結相同項目。


2. **級聯刪除 (Cascade Policy)**:
* **刪除 Mapping**: 當 `resume_content_mapping` 被刪除時，所有四張中間表的關聯應自動清理。
* **刪除原始資料**: 當 `student_certifications` 等原始資料被刪除時，所有引用該紀錄的履歷勾選狀態應自動消失。


3. **個人資料處理**:
* `student_info` 直接透過 `stu_info_id` 與 `resume_content_mapping` 關聯，無需額外中間表（因為一份履歷草稿通常只對應一份個人資料版本）。



---

## 4. Cursor 操作指引 (Instruction for AI)

當開發者要求「讀取履歷完整資訊」時，請遵循以下 JOIN 邏輯：

```sql
-- 以 resume_id 為入口查詢所有內容
SELECT 
    m.id AS mapping_id,
    r.original_filename,
    s.StuName,
    cert.CertName,
    grade.CourseName,
    lang.Language,
    abs.absence_type
FROM resume_content_mapping m
JOIN resumes r ON m.resume_id = r.id
JOIN student_info s ON m.stu_info_id = s.StuID
LEFT JOIN resume_cert_rel cert_rel ON m.id = cert_rel.mapping_id
LEFT JOIN student_certifications cert ON cert_rel.cert_id = cert.id
LEFT JOIN resume_grade_rel grade_rel ON m.id = grade_rel.mapping_id
LEFT JOIN course_grades grade ON grade_rel.grade_id = grade.id
LEFT JOIN resume_lang_rel lang_rel ON m.id = lang_rel.mapping_id
LEFT JOIN student_languageskills lang ON lang_rel.lang_skill_id = lang.id
LEFT JOIN resume_absence_rel abs_rel ON m.id = abs_rel.mapping_id
LEFT JOIN absence_records abs ON abs_rel.absence_id = abs.id
WHERE m.resume_id = [TARGET_ID];

```

---