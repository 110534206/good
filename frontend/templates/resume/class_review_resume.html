<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ™ºæ…§å¯¦ç¿’å¹³å° | å­¸ç”Ÿå±¥æ­·</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    header {
      background: linear-gradient(135deg, #0055a8 0%, #006acb 50%, #004f94 100%);
      border-bottom: none; position: sticky; top: 0; z-index: 10;
      box-shadow: 0 8px 20px rgba(0, 68, 148, 0.35);
    }
    .topbar {
      max-width: 1800px; margin: 0 auto; padding: 18px 24px;
      display: flex; align-items: center; justify-content: space-between; color: #fff;
    }
    .topbar-left { display: flex; align-items: center; }
    .topbar-left #menu-btn {
      width: 30px; height: 22px; cursor: pointer; display: flex; flex-direction: column;
      justify-content: space-between; background: none; border: none; padding: 0;
    }
    .topbar-left #menu-btn span {
      display: block; width: 100%; height: 3px; background-color: white; border-radius: 2px; transition: all 0.3s ease;
    }
    .topbar h1 { font-size: 1.5rem; margin: 0; text-align: center; color: #fff; flex: 1; }
    body { font-family: "Noto Sans TC", sans-serif; background: #ffffff; margin: 0; padding: 0; }
    main { max-width: 1800px; margin: 24px auto 60px; padding: 0 24px; display: flex; flex-direction: column; gap: 24px; }
    .panel {
      background: #ffffff; border-radius: 16px; padding: 24px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08); border: 1px solid #e2e8f0; margin-bottom: 32px;
    }
    .panel-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 16px; }
    .panel-header h2 { font-size: 1.2rem; margin: 0; }
    .table-wrapper { overflow-x: visible; width: 100%; }
    .table-wrapper table tbody tr:hover { background: rgba(15, 23, 42, 0.02); }
    .table thead th { text-align: left; background-color: #fafafb; }
    .table tbody td { text-align: left; vertical-align: middle; }
    .table tbody tr td:nth-child(1), .table tbody tr td:nth-child(2), 
    .table tbody tr td:nth-child(3), .table tbody tr td:nth-child(4) { vertical-align: top; }
    
    /* --- ç‹€æ…‹æ¨™ç±¤æ¨£å¼è¨­å®š --- */
    .status-badge { font-size: 0.9em; padding: 0.3em 0.6em; border-radius: 0.5rem; display: inline-block; font-weight: 600; }
    
    /* é€šéï¼šç¶ åº•ç™½å­— */
    .status-badge.bg-success { color: #fff; background-color: #198754; }
    
    /* é€€ä»¶ï¼šç´…åº•ç™½å­— */
    .status-badge.bg-danger { color: #fff; background-color: #dc3545; }
    
    /* å¾…å¯©æ ¸ï¼šè—åº•ç™½å­— */
    .status-badge.bg-info { color: #fff; background-color: #0dcaf0; }
    
    .status-badge.bg-secondary { color: #fff; background-color: #6c757d; }
    
    #side-menu {
      position: fixed; top: 0; left: 0; height: 100vh; width: 320px; max-width: 80vw;
      background-color: rgba(10, 10, 10, 0.95); backdrop-filter: blur(6px);
      box-shadow: 3px 0 12px rgba(0, 0, 0, 0.6); padding: 2rem 1.5rem;
      transform: translateX(-100%); transition: transform 0.3s ease-in-out; z-index: 1300;
      display: flex; flex-direction: column; align-items: flex-start; color: #fff; user-select: none;
    }
    #side-menu.open { transform: translateX(0); }
    #side-menu h2 { margin: 0 0 1.5rem 0; font-weight: 700; font-size: 1.6rem; color: #fff; }
    #close-btn {
      position: absolute; top: 2rem; right: 1.6rem; font-size: 2.2rem; background: none;
      border: none; color: #fff; cursor: pointer;
    }
    #side-menu a {
      display: block; width: 100%; padding: 0.6rem 0; font-size: 1.1rem; color: #e2e8f0;
      text-decoration: none; border-radius: 4px; transition: background-color 0.2s ease;
    }
    #side-menu a:hover { background-color: rgba(255, 255, 255, 0.18); color: #fff; }
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <div class="topbar-left">
        <button id="menu-btn" title="é¸å–®" role="button" tabindex="0" aria-label="é–‹å•Ÿå´é‚Šé¸å–®">
          <span></span><span></span><span></span>
        </button>
      </div>
      <h1>å­¸ç”Ÿå±¥æ­·</h1>
      <div style="width: 30px;"></div>
    </div>
  </header>
  <main>
    <section class="panel" aria-label="å±¥æ­·åˆ—è¡¨">
      <div class="panel-header">
        <h2 id="resumeListTitle">å±¥æ­·åˆ—è¡¨</h2>
      </div>
      <div style="display: flex; flex-wrap: wrap; gap: 16px; align-items: center; margin-bottom: 16px;">
        <select id="departmentFilter" style="padding: 10px 12px; border-radius: 8px; border: 1px solid #e2e8f0; min-width: 150px;">
          <option value="">æ‰€æœ‰å­¸å¹´</option>
        </select>
        <select id="classFilter" style="padding: 10px 12px; border-radius: 8px; border: 1px solid #e2e8f0; min-width: 150px;">
          <option value="">æ‰€æœ‰ç­ç´š</option>
        </select>
        <select id="companyNameFilter" style="padding: 10px 12px; border-radius: 8px; border: 1px solid #e2e8f0; min-width: 150px;">
          <option value="">æ‰€æœ‰å…¬å¸</option>
        </select>
        <select id="companyFilter" style="padding: 10px 12px; border-radius: 8px; border: 1px solid #e2e8f0; min-width: 150px;">
          <option value="">æ‰€æœ‰è·ç¼º</option>
        </select>
        <select id="statusFilter" style="padding: 10px 12px; border-radius: 8px; border: 1px solid #e2e8f0; min-width: 150px;">
          <option value="">æ‰€æœ‰ç‹€æ…‹</option>
          <option value="pending">å¾…å¯©æ ¸</option>
          <option value="approved">é€šé</option>
          <option value="rejected">é€€ä»¶</option>
        </select>
        <input type="text" id="searchBox" style="padding: 10px 12px; border-radius: 8px; border: 1px solid #e2e8f0; min-width: 200px; flex: 1;" placeholder="æœå°‹å¸³è™Ÿ/æª”æ¡ˆ" />
      </div>

      <div class="table-wrapper">
        <table style="width: 100%; border-collapse: collapse;">
          <thead style="background: #f1f5f9;">
            <tr>
              <th style="padding: 14px 16px; font-weight: 600;">å­¸ç”Ÿå¸³è™Ÿ</th>
              <th style="padding: 14px 16px; font-weight: 600;">å§“å</th>
              <th style="padding: 14px 16px; font-weight: 600;">ä¸Šå‚³æ™‚é–“</th>
              <th style="padding: 14px 16px; font-weight: 600;">æª”æ¡ˆåç¨±</th>
              <th style="padding: 14px 16px; font-weight: 600;">é¸æ“‡å…¬å¸</th>
              <th style="padding: 14px 16px; font-weight: 600;">è·ç¼º</th>
              <th style="padding: 14px 16px; font-weight: 600;">ç‹€æ…‹</th>
              <th style="padding: 14px 16px; font-weight: 600;">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="resumeTableBody">
            <tr><td colspan="8" style="padding: 14px 16px; text-align: center; color: #64748b;">è¼‰å…¥ä¸­...</td></tr>
          </tbody>
        </table>
      </div>
      <nav><ul class="pagination justify-content-center mt-3" id="pagination"></ul></nav>
    </section>
  </main>

  <nav id="side-menu" aria-hidden="true">
    <button id="close-btn">Ã—</button>
    <h2>åŠŸèƒ½é¸å–®</h2>
    <a href="/class_teacher_home">é¦–é </a>
    <a href="/profile">å€‹äººè³‡æ–™</a>
    <a href="/class_review_resume">æŸ¥çœ‹å­¸ç”Ÿå±¥æ­·</a>
    <a href="/review_preferences">å¯©æ ¸å¿—é¡˜åº</a>
    <a href="/admission/results">æŸ¥è©¢å­¸ç”ŸéŒ„å–çµæœ</a>
    <a href="/notifications">é€šçŸ¥</a>
  </nav>

  <!-- é€€ä»¶ç•™è¨€ Modal -->
  <div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="rejectModalLabel">é€€ä»¶å±¥æ­·</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="rejectForm">
            <input type="hidden" id="rejectResumeId" value="">
            <div class="mb-3">
              <label for="rejectComment" class="form-label">é€€ä»¶åŸå›  / è€å¸«ç•™è¨€ï¼š</label>
              <textarea class="form-control" id="rejectComment" rows="4" placeholder="è«‹è¼¸å…¥é€€ä»¶åŸå› æˆ–å»ºè­°..." required></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button type="button" class="btn btn-danger" onclick="confirmReject()">ç¢ºèªé€€ä»¶</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let allResumes = [];
    let userRole = null;
    let currentUserId = null;

    // å®šç¾©ç‹€æ…‹é¡è‰²
    function statusColor(status) {
      return { 'pending': 'info', 'approved': 'success', 'rejected': 'danger', 'submitted': 'info', 'uploaded': 'info', 'not_uploaded': 'secondary' }[status] || 'secondary';
    }

    // å®šç¾©ç‹€æ…‹æ–‡å­—
    function mapStatus(status) {
      return { 'pending': 'å¾…å¯©æ ¸', 'approved': 'é€šé', 'rejected': 'é€€ä»¶', 'submitted': 'å¾…å¯©æ ¸', 'uploaded': 'å¾…å¯©æ ¸', 'not_uploaded': 'æœªä¸Šå‚³' }[status] || 'å¾…å¯©æ ¸';
    }

    function escapeHtml(text) {
      if (text === null || text === undefined) return '';
      return String(text).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetch('/api/profile')
        .then(res => res.json())
        .then(profileData => {
          userRole = profileData.success && profileData.user ? profileData.user.role : 'class_teacher';
          currentUserId = profileData.success && profileData.user ? profileData.user.id : null;

          // --- [ä¿®æ”¹é–‹å§‹]ï¼šåŒæ™‚è¼‰å…¥å·²å¯©æ ¸å…¬å¸å’Œå­¸ç”Ÿå±¥æ­· ---

          // 1. è¼‰å…¥å·²å¯©æ ¸å…¬å¸åˆ—è¡¨ (å¾ç§‘åŠ©å¾Œå°ä½¿ç”¨çš„ API ç²å–)
          const fetchReviewedCompanies = fetch('/api/get_reviewed_companies')
            .then(res => res.json())
            // åªåœ¨æˆåŠŸæ™‚è¿”å›å…¬å¸åˆ—è¡¨ï¼Œå¤±æ•—å‰‡è¿”å›ç©ºé™£åˆ—
            .then(data => data.success ? (data.companies || []) : [])
            .catch(err => { 
                console.error("Error fetching reviewed companies:", err); 
                return []; 
            });

          // 2. è¼‰å…¥å­¸ç”Ÿå±¥æ­·åˆ—è¡¨
          // ã€åŠŸèƒ½ä¿®æ­£ 1ã€‘å°‡ API è·¯ç”±åç¨±å¾ /api/get_class_resumes ä¿®æ­£ç‚º /api/teacher_review_resumes
          const fetchClassResumes = fetch('/api/teacher_review_resumes') 
            .then(res => res.ok ? res.json() : {success:false})
            // ã€åŠŸèƒ½ä¿®æ­£ 2ã€‘ä¿®æ­£è³‡æ–™è®€å–æ¬„ä½ï¼Œå¾é è¨­çš„ resumes æ”¹ç‚ºå¾Œç«¯æ‡‰å›å‚³çš„ data
            .then(resumeData => resumeData.success ? (resumeData.data || []) : [])
            .catch(err => { 
              console.error("Error fetching class resumes:", err); 
              return []; 
            });

          // ç­‰å¾…å…©å€‹ API è«‹æ±‚éƒ½å®Œæˆ
          Promise.all([fetchReviewedCompanies, fetchClassResumes])
            .then(([reviewedCompanies, resumes]) => {
              console.log('ğŸ“Š è¼‰å…¥çš„å±¥æ­·æ•¸æ“š:', resumes);
              console.log('ğŸ“Š è¼‰å…¥çš„å…¬å¸æ•¸æ“š:', reviewedCompanies);
              allResumes = resumes;
              // å°‡å·²å¯©æ ¸å…¬å¸è³‡æ–™å‚³å…¥ï¼Œç”¨æ–¼å¡«å……ç¯©é¸å™¨
              populateFilters(allResumes, reviewedCompanies);
              applyFilters();
            })
            .catch(err => {
              console.error('âŒ è¼‰å…¥æ•¸æ“šå¤±æ•—:', err);
            });

          // --- [ä¿®æ”¹çµæŸ] ---
        });

      document.getElementById("departmentFilter").addEventListener("change", applyFilters);
      document.getElementById("classFilter").addEventListener("change", applyFilters);
      document.getElementById("companyNameFilter").addEventListener("change", applyFilters);
      document.getElementById("companyFilter").addEventListener("change", applyFilters);
      document.getElementById("statusFilter").addEventListener("change", applyFilters);
      document.getElementById("searchBox").addEventListener("input", applyFilters);
      
      const sideMenu = document.getElementById('side-menu');
      document.getElementById('menu-btn').onclick = () => { sideMenu.classList.add('open'); sideMenu.setAttribute('aria-hidden', 'false'); };
      document.getElementById('close-btn').onclick = () => { sideMenu.classList.remove('open'); sideMenu.setAttribute('aria-hidden', 'true'); };
    });

    // --- [ä¿®æ”¹é–‹å§‹]ï¼špopulateFilters å‡½å¼æ¥å— reviewedCompanies åƒæ•¸ ---
    function populateFilters(data, reviewedCompanies = []) {
      const deptSelect = document.getElementById("departmentFilter");
      // å­¸ç”Ÿæ‰€å±¬å­¸å¹´åˆ—è¡¨ (ç›®å‰å¯«æ­»)
      deptSelect.innerHTML = `<option value="">æ‰€æœ‰å­¸å¹´</option><option value="1132">1132</option><option value="1142">1142</option>`;
      
      const classSelect = document.getElementById("classFilter");
      classSelect.innerHTML = `
        <option value="">æ‰€æœ‰ç­ç´š</option>
        <option value="å¿ ç­">å¿ ç­</option>
        <option value="å­ç­">å­ç­</option>
      `;
      
      // å‹•æ…‹æ·»åŠ å…¶ä»–ç­ç´šï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
      const classSet = new Set();
      data.forEach(r => { 
        if(r.className && r.className !== "å¿ ç­" && r.className !== "å­ç­") {
          classSet.add(r.className);
        }
      });
      
      // å°‡å…¶ä»–ç­ç´šæŒ‰å­—æ¯é †åºæ’åºå¾ŒåŠ å…¥é¸å–®
      Array.from(classSet).sort().forEach(c => {
        classSelect.innerHTML += `<option value="${c}">${c}</option>`;
      });

      // å¡«å……å…¬å¸åç¨±ä¸‹æ‹‰é¸å–® (ä½¿ç”¨å·²å¯©æ ¸å…¬å¸åˆ—è¡¨)
      const companyNameSelect = document.getElementById("companyNameFilter");
      companyNameSelect.innerHTML = `<option value="">æ‰€æœ‰å…¬å¸</option>`;
      const companySet = new Set();
      
      // ä½¿ç”¨å¾ç§‘åŠ© API æŠ“å–çš„å·²å¯©æ ¸å…¬å¸åˆ—è¡¨
      reviewedCompanies.forEach(c => {
          // ç¯©é¸æ¢ä»¶ï¼šå·²æ ¸å‡† (approved) ä¸”æœ¬å­¸æœŸé–‹æ”¾ (is_open_current_semester)
          if (c.company_name && c.company_name.trim() && c.status === 'approved' && c.is_open_current_semester) {
              companySet.add(c.company_name.trim());
          }
      });
      
      Array.from(companySet).sort().forEach(companyName => {
          companyNameSelect.innerHTML += `<option value="${escapeHtml(companyName)}">${escapeHtml(companyName)}</option>`;
      });

      // å¡«å……è·ç¼ºä¸‹æ‹‰é¸å–® (å¾å·²å¯©æ ¸å…¬å¸åˆ—è¡¨ä¸­æå–)
      const companySelect = document.getElementById("companyFilter");
      companySelect.innerHTML = `<option value="">æ‰€æœ‰è·ç¼º</option>`;
      const jobSet = new Set();
      
      // ä½¿ç”¨å¾ç§‘åŠ© API æŠ“å–çš„å·²å¯©æ ¸å…¬å¸åˆ—è¡¨
      reviewedCompanies.forEach(c => {
          // ç¯©é¸æ¢ä»¶ï¼šå·²æ ¸å‡† (approved) ä¸”æœ¬å­¸æœŸé–‹æ”¾ (is_open_current_semester)
          if (c.status === 'approved' && c.is_open_current_semester && Array.isArray(c.jobs)) {
              // éæ­·è©²å…¬å¸çš„æ‰€æœ‰è·ç¼º
              c.jobs.forEach(jobTitle => {
                  if (jobTitle && String(jobTitle).trim()) {
                      jobSet.add(String(jobTitle).trim());
                  }
              });
          }
      });
      
      Array.from(jobSet).sort().forEach(j => {
          companySelect.innerHTML += `<option value="${escapeHtml(j)}">${escapeHtml(j)}</option>`;
      });
    }
    // --- [ä¿®æ”¹çµæŸ]ï¼špopulateFilters å‡½å¼ ---

    function applyFilters() {
      const dept = document.getElementById("departmentFilter").value.trim();
      const cls = document.getElementById("classFilter").value.trim();
      const companyName = document.getElementById("companyNameFilter").value.trim();
      const jobFilter = document.getElementById("companyFilter").value.trim();
      const status = document.getElementById("statusFilter").value.trim();
      const keyword = document.getElementById("searchBox").value.trim().toLowerCase();

      const filtered = allResumes.filter(r => {
        const matchesDept = !dept || r.department === dept;
        const matchesClass = !cls || r.className === cls;
        const matchesKeyword = (r.username && r.username.toLowerCase().includes(keyword)) ||
                               (r.original_filename && r.original_filename.toLowerCase().includes(keyword));
        
        let matchesCompanyName = true;
        if (companyName) {
            const companyNameStr = (r.company_name || '').trim();
            // ç”±æ–¼ç¯©é¸å™¨æ˜¯å¾å·²å¯©æ ¸å…¬å¸åˆ—è¡¨ä¸­å¡«å……ï¼Œé€™è£¡ç›´æ¥æ¯”å°åç¨±
            matchesCompanyName = companyNameStr === companyName;
        }
        
        let matchesJob = true;
        if (jobFilter) {
            const jobs = (r.job_title || r.jobTitle || '').toLowerCase();
            matchesJob = jobs.includes(jobFilter.toLowerCase()) || (r.job_id && String(r.job_id) === jobFilter);
        }

        let matchesStatus = true;
        if (status) {
           const statusStr = r.application_statuses || r.display_status || r.status || '';
           // å®Œå…¨åŒ¹é…ç‹€æ…‹ï¼ˆå› ç‚ºå¾Œç«¯å·²ç¶“å°‡ uploaded æ˜ å°„ç‚º pendingï¼‰
           matchesStatus = statusStr === status;
        }

        return matchesDept && matchesClass && matchesCompanyName && matchesJob && matchesStatus && matchesKeyword;
      });

      renderTable(filtered);
    }

    function renderTable(resumes) {
      const tbody = document.getElementById("resumeTableBody");
      tbody.innerHTML = "";
      if (resumes.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; color: #64748b; padding: 16px;">ç›®å‰æ²’æœ‰è³‡æ–™</td></tr>`;
        document.getElementById("pagination").innerHTML = "";
        return;
      }

      const filterStatus = document.getElementById("statusFilter").value.trim(); 
      const filterJob = document.getElementById("companyFilter").value.trim(); 

      let allRowsData = [];

      resumes.forEach(r => {
        const comp = r.company_name || 'â€”';
        const job = r.job_title || r.jobTitle || 'â€”';
        const st = r.application_statuses || r.display_status || r.status || 'pending';

        // ç‹€æ…‹ç¯©é¸
        if (filterStatus && st !== filterStatus) return;
        
        // è·ç¼ºç¯©é¸
        if (filterJob && !job.includes(filterJob) && filterJob !== (r.job_id ? String(r.job_id) : '')) return;

        allRowsData.push({
            ...r,
            display_company: comp,
            display_job: job,
            display_status: st
        });
      });

      // é¡¯ç¤ºæ‰€æœ‰è³‡æ–™ï¼Œä¸åˆ†é 
      allRowsData.forEach(row => {
        const tr = document.createElement('tr');
        tr.style.borderBottom = '1px solid #e2e8f0';
        tr.innerHTML = `
           <td style="padding: 14px 16px;">${row.username}</td>
           <td style="padding: 14px 16px;">${escapeHtml(row.name)}</td>
           <td style="padding: 14px 16px;">${row.upload_time}</td>
           <td style="padding: 14px 16px; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${escapeHtml(row.original_filename)}</td>
           <td style="padding: 14px 16px;">${escapeHtml(row.display_company)}</td>
           <td style="padding: 14px 16px;">${escapeHtml(row.display_job)}</td>
           <td style="padding: 14px 16px;">
             <span class="status-badge bg-${statusColor(row.display_status)}">${mapStatus(row.display_status)}</span>
           </td>
           <td style="padding: 14px 16px;">
             <div style="display: flex; gap: 4px; flex-wrap: wrap;">
               <a href="/api/download_resume/${row.id}" class="btn btn-sm btn-outline-primary" target="_blank">ä¸‹è¼‰</a>
               ${(row.display_status === 'pending' || row.display_status === 'uploaded') && row.display_status !== 'not_uploaded' ? `
                 <button class="btn btn-sm btn-success" onclick="approveResume(${row.id})">é€šé</button>
                 <button class="btn btn-sm btn-danger" onclick="rejectResume(${row.id})">é€€ä»¶</button>
               ` : ''}
             </div>
           </td>
        `;
        tbody.appendChild(tr);
      });

      // éš±è—åˆ†é 
      document.getElementById("pagination").innerHTML = "";
    }


    // é€šéå±¥æ­·
    function approveResume(resumeId) {
      if (!confirm('ç¢ºå®šè¦é€šéæ­¤å±¥æ­·å—ï¼Ÿ')) {
        return;
      }

      fetch(`/api/review_resume/${resumeId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          status: 'approved',
          comment: ''
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('å±¥æ­·å·²é€šéå¯©æ ¸');
          // é‡æ–°è¼‰å…¥æ•¸æ“š
          location.reload();
        } else {
          alert('æ“ä½œå¤±æ•—ï¼š' + (data.message || 'æœªçŸ¥éŒ¯èª¤'));
        }
      })
      .catch(err => {
        console.error('é€šéå±¥æ­·éŒ¯èª¤:', err);
        alert('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      });
    }

    // é€€ä»¶å±¥æ­·ï¼ˆæ‰“é–‹ç•™è¨€ Modalï¼‰
    function rejectResume(resumeId) {
      document.getElementById('rejectResumeId').value = resumeId;
      document.getElementById('rejectComment').value = '';
      const modal = new bootstrap.Modal(document.getElementById('rejectModal'));
      modal.show();
    }

    // ç¢ºèªé€€ä»¶
    function confirmReject() {
      const resumeId = document.getElementById('rejectResumeId').value;
      const comment = document.getElementById('rejectComment').value.trim();

      if (!comment) {
        alert('è«‹è¼¸å…¥é€€ä»¶åŸå› ');
        return;
      }

      fetch(`/api/review_resume/${resumeId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          status: 'rejected',
          comment: comment
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('å±¥æ­·å·²é€€ä»¶');
          // é—œé–‰ Modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('rejectModal'));
          modal.hide();
          // é‡æ–°è¼‰å…¥æ•¸æ“š
          location.reload();
        } else {
          alert('æ“ä½œå¤±æ•—ï¼š' + (data.message || 'æœªçŸ¥éŒ¯èª¤'));
        }
      })
      .catch(err => {
        console.error('é€€ä»¶å±¥æ­·éŒ¯èª¤:', err);
        alert('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      });
    }
  </script>
</body>
</html>