<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ™ºæ…§å¯¦ç¿’å¹³å° | å±¥æ­·ç®¡ç†å¹³å°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    header {
      background: #0454a3;
      color: white;
      padding: 1rem 2rem;
      text-align: center;
      font-size: 1.5rem;
    }

    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #f7f9fc;
    }

    .container {
      max-width: 1000px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .card {
      border-radius: 10px;
    }

    table {
      font-size: 0.95rem;
    }
  </style>
</head>

<body>
  <header>æ™ºæ…§å¯¦ç¿’å¹³å° | å±¥æ­·ç®¡ç†</header>

  <div class="container">
    <ul class="nav nav-tabs mb-4">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#form-pane">ğŸ“ å¡«å¯«å±¥æ­·</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#records-pane">ğŸ“‚ å±¥æ­·ç´€éŒ„</button>
      </li>
    </ul>

    <div class="tab-content">
      <!-- å¡«å¯«å±¥æ­· -->
      <div class="tab-pane fade show active" id="form-pane">
        <form id="resumeForm" enctype="multipart/form-data">
          <!-- åŸºæœ¬è³‡æ–™ -->
          <div class="card p-4 mb-3">
            <h5 class="text-primary">ğŸ‘¤ å€‹äººåŸºæœ¬è³‡æ–™</h5>
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">å§“å</label>
                <input type="text" name="name" class="form-control" required />
              </div>
              <div class="col-md-4">
                <label class="form-label">å‡ºç”Ÿæ—¥æœŸ</label>
                <input type="date" name="birth_date" class="form-control" required />
              </div>
              <div class="col-md-4">
                <label class="form-label">æ€§åˆ¥</label>
                <select name="gender" class="form-select" required>
                  <option value="">è«‹é¸æ“‡</option>
                  <option value="ç”·">ç”·</option>
                  <option value="å¥³">å¥³</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">è¯çµ¡é›»è©±</label>
                <input type="tel" name="phone" class="form-control" required />
              </div>
              <div class="col-md-6">
                <label class="form-label">é›»å­ä¿¡ç®±</label>
                <input type="email" name="email" class="form-control" required />
              </div>
              <div class="col-12">
                <label class="form-label">åœ°å€</label>
                <input type="text" name="address" class="form-control" required />
              </div>
              <div class="col-md-6">
                <label class="form-label">æ“è¡Œæˆç¸¾åˆ†æ•¸ (0-100)</label>
                <input type="number" name="conduct_score_numeric" class="form-control" min="0" max="100" required>
              </div>
              <input type="hidden" name="conduct_score" id="conduct_score">
              <div class="col-md-6">
                <label class="form-label">ä¸Šå‚³ç…§ç‰‡ (jpg)</label>
                <input type="file" name="photo" class="form-control" accept="image/jpeg, .jpg" />
              </div>
            </div>
          </div>

          <!-- ä¿®èª²ç§‘ç›® -->
          <div class="card p-4 mb-3">
            <h5 class="text-success">ğŸ“˜ å·²ä¿®ç¿’å°ˆæ¥­æ ¸å¿ƒç§‘ç›®ï¼ˆè‡ªå‹•è¼‰å…¥ï¼‰</h5>
            <table class="table table-bordered text-center">
              <thead class="table-light">
                <tr><th>ç§‘ç›®åç¨±</th><th>å­¸åˆ†</th></tr>
              </thead>
              <tbody id="courseTableBody"></tbody>
            </table>
          </div>

          <!-- ç›¸é—œè­‰ç…§ -->
          <div class="card p-4 mb-3">
            <h5 class="text-secondary">ğŸ… ç›¸é—œè­‰ç…§</h5>
            <table class="table table-bordered text-center align-middle">
              <thead class="table-light">
                <tr>
                  <th>å‹å‹•éƒ¨è­‰ç…§</th>
                  <th>åœ‹éš›è­‰ç…§</th>
                  <th>åœ‹å…§è­‰ç…§</th>
                  <th>å…¶ä»–è­‰ç…§</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="certificate-table-body">
                <tr>
                  <td><input type="text" name="labor_cert[]" class="form-control" placeholder="ä¾‹ï¼šé›»è…¦è»Ÿé«”æ‡‰ç”¨ä¹™ç´š"></td>
                  <td><input type="text" name="international_cert[]" class="form-control" placeholder="ä¾‹ï¼šTOEIC 800åˆ†"></td>
                  <td><input type="text" name="domestic_cert[]" class="form-control" placeholder="ä¾‹ï¼šä¸­é¤ä¸™ç´š"></td>
                  <td><input type="text" name="other_cert[]" class="form-control" placeholder="ä¾‹ï¼šå°ˆé¡Œç«¶è³½ã€ç ”ç¿’ç‡Ÿ"></td>
                  <td><button type="button" class="btn btn-outline-danger btn-sm remove-row">ç§»é™¤</button></td>
                </tr>
              </tbody>
            </table>
            <button type="button" class="btn btn-sm btn-outline-success" id="add-certificate-row">ï¼‹æ–°å¢ä¸€åˆ—</button>
          </div>

          <!-- èªæ–‡èƒ½åŠ› -->
          <div class="card p-4 mb-3">
            <h5 class="text-warning">ğŸŒ èªæ–‡èƒ½åŠ›</h5>
            <div id="language-section"></div>
          </div>

          <!-- è‡ªå‚³ -->
          <div class="card p-4 mb-3">
            <h5 class="text-info">ğŸ–‹ è‡ªå‚³</h5>
            <textarea name="autobiography" rows="6" class="form-control"
              placeholder="è«‹æè¿°å®¶åº­ç”Ÿæ´»ã€æ±‚å­¸ç¶“éã€å€‹äººå°ˆé•·ã€æœªä¾†è¦åŠƒç­‰..." required></textarea>
          </div>

          <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg">æäº¤ä¸¦ç”Ÿæˆå±¥æ­·</button>
          </div>
        </form>
      </div>

      <!-- å±¥æ­·ç´€éŒ„ -->
      <div class="tab-pane fade" id="records-pane">
        <div id="resumeRecords" class="p-3">
          <table class="table table-striped align-middle text-center">
            <thead class="table-light">
              <tr><th>ç”Ÿæˆæ™‚é–“</th><th>æª”å</th><th>ä¸‹è¼‰</th></tr>
            </thead>
            <tbody id="recordsBody">
              <tr><td colspan="3" class="text-muted">å°šç„¡å±¥æ­·ç´€éŒ„</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const fixedCourses = [
      { name: "è³‡è¨Šç§‘æŠ€", credits: 2 },
      { name: "ç¨‹å¼è¨­è¨ˆ", credits: "3/3" },
      { name: "JAVAç¨‹å¼èªè¨€", credits: "3/3" },
      { name: "è³‡è¨Šç§‘æŠ€é€²éš", credits: 2 },
      { name: "è¡Œå‹•ç¶²é ç¨‹å¼é–‹ç™¼", credits: "3/3" },
      { name: "è³‡æ–™åº«ä¼ºæœå™¨ç®¡ç†èˆ‡å¯¦ä½œ", credits: 2 }
    ];

    const languages = [
      { code: "en", name: "è‹±èª" },
      { code: "jp", name: "æ—¥èª" },
      { code: "tw", name: "å°èª" },
      { code: "hk", name: "å®¢èª" }
    ];

    document.addEventListener("DOMContentLoaded", () => {
      const tbody = document.getElementById("courseTableBody");
      fixedCourses.forEach(c => {
        tbody.innerHTML += `<tr><td>${c.name}</td><td>${c.credits}</td></tr>`;
      });

      // èªæ–‡èƒ½åŠ›
      const langSection = document.getElementById("language-section");
      languages.forEach(lang => {
        langSection.innerHTML += `
          <h6 class="mt-2">${lang.name}</h6>
          <div class="row mb-2">
            ${["è½", "èªª", "è®€", "å¯«"].map(skill => `
              <div class="col-md-3">
                <label>${skill}</label>
                <select name="lang_${lang.code}_${skill}" class="form-select">
                  <option value="">è«‹é¸æ“‡</option>
                  <option value="ç²¾é€š">ç²¾é€š</option>
                  <option value="ä¸­ç­‰">ä¸­ç­‰</option>
                  <option value="ç•¥æ‡‚">ç•¥æ‡‚</option>
                </select>
              </div>
            `).join('')}
          </div>
        `;
      });

      // æ“è¡Œæˆç¸¾è½‰æ›
      const scoreInput = document.querySelector('input[name="conduct_score_numeric"]');
      const hiddenGrade = document.getElementById("conduct_score");
      scoreInput.addEventListener("input", () => {
        const score = parseInt(scoreInput.value);
        let grade = "";
        if (score >= 90) grade = "å„ª";
        else if (score >= 80) grade = "ç”²";
        else if (score >= 70) grade = "ä¹™";
        else if (score >= 60) grade = "ä¸™";
        else if (score >= 0) grade = "ä¸";
        hiddenGrade.value = grade;
      });

      // æ–°å¢ / ç§»é™¤ã€Œç›¸é—œè­‰ç…§ã€åˆ—
      document.getElementById("add-certificate-row").addEventListener("click", () => {
        const tbody = document.getElementById("certificate-table-body");
        tbody.insertAdjacentHTML("beforeend", `
          <tr>
            <td><input type="text" name="labor_cert[]" class="form-control"></td>
            <td><input type="text" name="international_cert[]" class="form-control"></td>
            <td><input type="text" name="domestic_cert[]" class="form-control"></td>
            <td><input type="text" name="other_cert[]" class="form-control"></td>
            <td><button type="button" class="btn btn-outline-danger btn-sm remove-row">ç§»é™¤</button></td>
          </tr>
        `);
      });

      document.getElementById("certificate-table-body").addEventListener("click", e => {
        if (e.target.classList.contains("remove-row")) {
          e.target.closest("tr").remove();
        }
      });

      // è¡¨å–®é€å‡º
      document.getElementById("resumeForm").addEventListener("submit", async e => {
        e.preventDefault();
        const formData = new FormData(e.target);
        formData.append("courses", JSON.stringify(fixedCourses));
        const res = await fetch("/api/submit_and_generate", { method: "POST", body: formData });
        const result = await res.json();
        if (result.success) {
          alert("âœ… å±¥æ­·å·²ç”Ÿæˆï¼Œå¯æ–¼ä¸‹æ–¹ç´€éŒ„é ç±¤ä¸‹è¼‰");
          const tabTrigger = new bootstrap.Tab(document.querySelector('[data-bs-target="#records-pane"]'));
          tabTrigger.show();
          await loadResumeRecords();
        } else alert("âŒ æäº¤å¤±æ•—ï¼š" + (result.message || "æœªçŸ¥éŒ¯èª¤"));
      });

      async function loadResumeRecords() {
        const res = await fetch("/api/get_my_resumes");
        const data = await res.json();
        const tbody = document.getElementById("recordsBody");
        tbody.innerHTML = "";
        if (!data.success || data.resumes.length === 0)
          return tbody.innerHTML = `<tr><td colspan="3" class="text-muted">å°šç„¡å±¥æ­·ç´€éŒ„</td></tr>`;
        data.resumes.forEach(r => {
          tbody.innerHTML += `<tr><td>${r.upload_time}</td><td>${r.original_filename}</td>
          <td><a href="/api/download_resume/${r.id}" class="btn btn-sm btn-outline-primary" target="_blank">ä¸‹è¼‰</a></td></tr>`;
        });
      }
    });
  </script>
</body>
</html>
