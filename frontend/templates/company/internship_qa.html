<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <title>智慧實習平台 | 實習常見 Q&A</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    header {
      background: #0454a3;
      color: white;
      padding: 1rem 2rem;
      text-align: center;
      font-size: 1.5rem;
    }

    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #f7f9fc;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1200px;
      margin: auto;
    }

    /* 標籤頁 */
    .nav-tabs .nav-link {
      color: #6c757d;
    }

    .nav-tabs .nav-link.active {
      color: #0066cc;
      border-color: #0066cc #0066cc #fff;
    }

    /* 表格 */
    table thead th,
    table td {
      text-align: center;
      vertical-align: middle;
      font-size: 0.95rem;
    }

    .tab-content.border {
      border-color: #0066cc !important;
    }

    .custom-header-blue {
      background-color: #0066cc;
      color: white;
      border-color: #0066cc;
    }

    .status-badge {
      font-weight: bold;
      border-radius: 5px;
      padding: 0.2rem 0.6rem;
    }

    /* 彈窗 */
    .modal-dialog {
      max-width: 800px;
    }

    .company-detail-box {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #f8f9fa;
    }

    .job-item {
      border-left: 4px solid #0066cc;
      padding-left: 10px;
      margin-bottom: 10px;
      background-color: #e9ecef;
      padding: 10px;
      border-radius: 4px;
    }

    .detail-label {
      font-weight: bold;
      color: #495057;
      margin-right: 5px;
    }
  </style>
</head>

<body>
  <header>實習常見 Q&A</header>
  <div class="container">
    <div class="top-bar-left">
      <div id="menu-btn" title="選單" role="button">
        <span></span><span></span><span></span>
      </div>
    </div>
  </div>
  </div>

  <div class="container my-4">

  <h3>實習常見 Q&A</h3>

  <!-- 搜尋欄 -->
  <input id="qa-search" type="text" class="form-control mt-3" placeholder="搜尋問題關鍵字…">

  <!-- 狀態提示 -->
  <div id="qa-status" class="text-muted mt-2">載入中…</div>

  <!-- QA 列表 -->
  <div class="accordion mt-3" id="qa-container"></div>
</div>

<!-- 修正版 -->
<script>
// --- 安全轉義，避免 HTML 注入 (XSS) ---
function escapeHTML(str) {
  if (typeof str !== "string") return "";
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// --- 載入 QA 資料 ---
async function loadQA() {
  const container = document.getElementById("qa-container");
  const status = document.getElementById("qa-status");

  try {
    const res = await fetch("/api/qa/list");
    const json = await res.json();

    if (!json.success) {
      status.textContent = "資料載入失敗";
      return;
    }

    const list = json.data;

    if (!list.length) {
      status.textContent = "目前尚無常見問答";
      return;
    }

    status.style.display = "none";

    container.innerHTML = list.map(item => `
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading-${item.id}">
          <button class="accordion-button collapsed" type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#qa-${item.id}"
                  aria-expanded="false"
                  aria-controls="qa-${item.id}">
            ${escapeHTML(item.question)}
          </button>
        </h2>

        <div id="qa-${item.id}" class="accordion-collapse collapse" 
             aria-labelledby="heading-${item.id}" 
             data-bs-parent="#qa-container">
          <div class="accordion-body">
            ${item.answer}
          </div>
        </div>
      </div>
    `).join("");

  } catch {
    status.textContent = "無法連線至伺服器，請稍後再試";
  }
}

// --- 搜尋功能 ---
document.getElementById("qa-search").addEventListener("input", function () {
  const keyword = this.value.toLowerCase();
  document.querySelectorAll(".accordion-item").forEach(item => {
    const text = item.textContent.toLowerCase();  // 改成 textContent
    item.style.display = text.includes(keyword) ? "" : "none";
  });
});

// 載入資料
loadQA();
</script>
</body>
</html>