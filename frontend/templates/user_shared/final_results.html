<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>智慧實習平台 | 志願序最終結果</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      overflow-x: hidden;
    }

    header {
      background: #0454a3;
      color: white;
      padding: 1rem 2rem;
      text-align: center;
      font-size: 1.5rem;
    }

    /* 三條線選單按鈕樣式 */
    .top-bar-left {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1100;
    }

    .top-bar-left #menu-btn {
      width: 30px;
      height: 22px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: none;
      border: none;
      padding: 0;
    }

    .top-bar-left #menu-btn span {
      display: block;
      width: 100%;
      height: 3px;
      background-color: white;
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    #side-menu {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 320px;
      max-width: 80vw;
      background-color: rgba(10, 10, 10, 0.95);
      backdrop-filter: blur(6px);
      box-shadow: 3px 0 12px rgb(0 0 0 / 0.7);
      padding: 2rem 1.5rem;
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
      z-index: 1200;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      color: white;
      user-select: none;
    }

    #side-menu.open {
      transform: translateX(0);
    }

    #side-menu .menu-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      margin-bottom: 1.5rem;
    }

    #side-menu h2 {
      margin: 0;
      font-weight: 700;
      font-size: 1.5rem;
      text-align: left;
      flex: 1;
    }

    #close-btn {
      font-size: 2.2rem;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      line-height: 1;
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      margin: 0;
    }

    #side-menu a {
      display: block;
      width: 100%;
      padding: 0.5rem 0;
      font-size: 1.1rem;
      color: #ddd;
      text-decoration: none;
      border-radius: 4px;
      transition: background-color 0.2s ease;
    }

    #side-menu a:hover {
      background-color: rgba(255, 255, 255, 0.15);
      color: white;
    }

    .container {
      max-width: 1200px;
      margin-top: 2rem;
    }

    h2 {
      margin: 30px 0 20px;
      color: #e1e3e5;
      font-weight: 700;
      text-align: center;
    }

    .student-section {
      background: #fff;
      margin-bottom: 1.5rem;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .student-section h3 {
      color: #0066cc;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .student-section .class-label {
      font-weight: normal;
      color: #555;
      margin-bottom: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }

    th,
    td {
      padding: 0.75rem;
      border: 1px solid #e0e0e0;
      text-align: center;
    }

    th {
      background-color: #f1f4f8;
    }

    .input-group {
      max-width: 250px;
      margin-right: 0.5rem;
    }

    .btn-group button {
      margin-left: 0.5rem;
    }
  </style>
</head>

<body>
  <header>學生最終志願序結果</header>
  <div class="top-bar-left">
    <div id="menu-btn" title="選單" role="button" tabindex="0">
      <span></span><span></span><span></span>
    </div>
  </div>

  <!-- 側邊選單 -->
  <nav id="side-menu">
    <div class="menu-header">
      <h2>功能選單</h2>
      <button id="close-btn">×</button>
    </div>
    <a href="/ta_home">首頁</a>
    <a href="/profile">個人資料</a>
    <a href="/announcement/manage_announcements">公告管理</a>
    <a href="/ta/statistics/manage_companies">實習廠商管理</a>
    <a href="/final_results">志願序結果</a>
    <a href="/notifications">通知</a>
    <a href="/admin/absence_default_range">缺勤預設學期範圍設定</a>
    <a href="/ta/upload_standard_courses">專業核心科目管理</a>
    <a href="/ta/match_results">媒合結果確認</a>
    <a href="/login">登出</a>
  </nav>

  <div class="container mt-4">
    <!-- 查詢與匯出 -->
    <div class="d-flex flex-wrap justify-content-center align-items-center mb-4 gap-2">
      <input type="text" id="searchStudentInput" class="form-control" placeholder="學生姓名">
      <input type="text" id="searchClassInput" class="form-control" placeholder="班級">
      <input type="text" id="searchCompanyInput" class="form-control" placeholder="公司名稱">
      <button id="searchBtn" class="btn btn-outline-secondary"><i class="fas fa-search"></i> 查詢</button>
      <button id="clearBtn" class="btn btn-warning"><i class="fas fa-eraser"></i> 清除查詢</button>
      <div class="btn-group" role="group">
        <button id="exportExcelBtn" class="btn btn-success"><i class="fas fa-file-excel"></i> Excel</button>
        <button id="exportWordBtn" class="btn btn-info"><i class="fas fa-file-word"></i> Word</button>
        <button id="exportPdfBtn" class="btn btn-danger"><i class="fas fa-file-pdf"></i> PDF</button>
      </div>
    </div>

    <!-- 學生資料區，動態生成 -->
    <div id="studentContainer">
      <!-- 學生資料將由後端或前端 JS 動態生成，此處不顯示範例 -->
    </div>
  </div>

  <script>
    // 選單開關邏輯
    const menuBtn = document.getElementById("menu-btn");
    const sideMenu = document.getElementById("side-menu");
    const closeBtn = document.getElementById("close-btn");

    menuBtn.addEventListener("click", () => {
      sideMenu.classList.add("open");
      sideMenu.setAttribute("aria-hidden", "false");
    });

    closeBtn.addEventListener("click", () => {
      sideMenu.classList.remove("open");
      sideMenu.setAttribute("aria-hidden", "true");
    });

    // 如果點擊 menu 以外的地方就關閉選單
    document.addEventListener("click", (e) => {
      if (
        !sideMenu.contains(e.target) &&
        !menuBtn.contains(e.target)
      ) {
        sideMenu.classList.remove("open");
        sideMenu.setAttribute("aria-hidden", "true");
      }
    });

    function filterStudents() {
      const nameTerm = document.getElementById('searchStudentInput').value.trim().toLowerCase();
      const classTerm = document.getElementById('searchClassInput').value.trim().toLowerCase();
      const companyTerm = document.getElementById('searchCompanyInput').value.trim().toLowerCase();

      const visibleStudents = [];
      document.querySelectorAll('.student-section').forEach(section => {
        const name = section.dataset.name.toLowerCase();
        const className = section.dataset.class.toLowerCase();
        const companyMatches = Array.from(section.querySelectorAll('table tbody tr td:nth-child(2)'))
          .some(td => td.textContent.toLowerCase().includes(companyTerm));

        const show = (!nameTerm || name.includes(nameTerm)) &&
          (!classTerm || className.includes(classTerm)) &&
          (!companyTerm || companyMatches);

        section.style.display = show ? 'block' : 'none';
        if (show) visibleStudents.push(section);
      });
      return visibleStudents;
    }

    document.getElementById('searchBtn').addEventListener('click', filterStudents);
    document.getElementById('clearBtn').addEventListener('click', () => {
      document.getElementById('searchStudentInput').value = '';
      document.getElementById('searchClassInput').value = '';
      document.getElementById('searchCompanyInput').value = '';
      document.querySelectorAll('.student-section').forEach(section => section.style.display = 'block');
    });

    document.getElementById('exportExcelBtn').addEventListener('click', () => {
      const visibleStudents = filterStudents();
      let csvContent = "學生姓名,班級,志願序,公司名稱,送出時間\n";
      visibleStudents.forEach(section => {
        const studentName = section.dataset.name;
        const className = section.dataset.class;
        section.querySelectorAll('table tbody tr').forEach(tr => {
          const order = tr.children[0].textContent;
          const company = tr.children[1].textContent;
          const time = tr.children[2].textContent;
          csvContent += `${studentName},${className},${order},${company},${time}\n`;
        });
      });
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "學生志願序.csv";
      link.click();
    });

    function exportTextFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }

    document.getElementById('exportWordBtn').addEventListener('click', () => {
      const visibleStudents = filterStudents();
      let content = '';
      visibleStudents.forEach(section => {
        content += `學生: ${section.dataset.name}\n班級: ${section.dataset.class}\n`;
        section.querySelectorAll('table tbody tr').forEach(tr => {
          content += `志願序:${tr.children[0].textContent}, 公司:${tr.children[1].textContent}, 送出時間:${tr.children[2].textContent}\n`;
        });
        content += '\n';
      });
      exportTextFile('學生志願序.docx', content);
    });

    document.getElementById('exportPdfBtn').addEventListener('click', () => {
      const visibleStudents = filterStudents();
      let content = '';
      visibleStudents.forEach(section => {
        content += `學生: ${section.dataset.name}\n班級: ${section.dataset.class}\n`;
        section.querySelectorAll('table tbody tr').forEach(tr => {
          content += `志願序:${tr.children[0].textContent}, 公司:${tr.children[1].textContent}, 送出時間:${tr.children[2].textContent}\n`;
        });
        content += '\n';
      });
      exportTextFile('學生志願序.pdf', content);
    });
  </script>
</body>

</html>