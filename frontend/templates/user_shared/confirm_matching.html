<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ™ºæ…§å¯¦ç¿’å¹³å° | å» å•†åª’åˆçµæœ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root {
      --brand-blue: #0066cc;
      --brand-blue-dark: #024689;
      --bg-light: #f5f8ff;
      --border-light: #dbe4f4;
      --text-dark: #1f2937;
      --text-muted: #6b7280;
      --success-green: #0ea5e9;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Noto Sans TC", "Segoe UI", sans-serif;
      background: #ffffff;
      color: var(--text-dark);
      position: relative;
      min-height: 100vh;
      overflow-x: hidden;
    }

    header {
      background: linear-gradient(135deg, #0055a8 0%, #006acb 50%, #004f94 100%);
      border-bottom: none;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 8px 20px rgba(0, 68, 148, 0.35);
    }

    .topbar {
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      position: relative;
    }

    .topbar h1 {
      font-size: 1.5rem;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      color: #fff;
      flex: 1;
    }

    .topbar h1 .header-title {
      flex: 1;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .topbar h1 i {
      color: #ffe27a;
    }


    /* é¸å–®æŒ‰éˆ•æ¨£å¼ */
    #menu-btn {
      width: 30px;
      height: 22px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: none;
      border: none;
      padding: 0;
    }

    #menu-btn span {
      display: block;
      width: 100%;
      height: 3px;
      background-color: white;
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    /* å´é‚Šé¸å–®æ¨£å¼ */
    #side-menu {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 320px;
      max-width: 80vw;
      background-color: rgba(10, 10, 10, 0.95);
      backdrop-filter: blur(6px);
      box-shadow: 3px 0 12px rgba(0, 0, 0, 0.6);
      padding: 2rem 1.5rem;
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
      z-index: 1300;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      color: #fff;
      user-select: none;
    }

    #side-menu.open {
      transform: translateX(0);
    }

    #close-btn {
      position: absolute;
      top: 2rem;
      right: 1.6rem;
      font-size: 2.8rem;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      line-height: 2.4rem;
      height: 2.5rem;
      width: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    #side-menu h2 {
      margin: 0 0 1.5rem 0;
      font-weight: 700;
      font-size: 1.6rem;
      color: #fff;
      padding: 0;
      line-height: 2.4rem;
      height: 2.4rem;
      display: flex;
      align-items: center;
    }

    #side-menu a {
      display: block;
      width: 100%;
      padding: 0.6rem 0;
      font-size: 1.1rem;
      color: #e2e8f0;
      text-decoration: none;
      border-radius: 4px;
      transition: background-color 0.2s ease;
    }

    #side-menu a:hover {
      background-color: rgba(255, 255, 255, 0.18);
      color: #fff;
    }

    main {
      max-width: 1200px;
      margin: 24px auto 60px;
      padding: 0 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .panel {
      background: #ffffff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
      border: 1px solid #e2e8f0;
      margin-bottom: 32px;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .panel-header h2 {
      font-size: 1.2rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel-header h2 i {
      color: #0066cc;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    .table-wrapper table tbody tr:hover {
      background: rgba(15, 23, 42, 0.02);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .summary-item {
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: #fff;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.02);
    }

    .summary-item span:first-child {
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    .summary-item span:last-child {
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--brand-blue-dark);
    }

    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      margin-bottom: 16px;
    }

    .filter-bar label {
      font-weight: 600;
      color: var(--text-muted);
    }

    .filter-bar select,
    .filter-bar input {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border-light);
      min-width: 220px;
      font-size: 0.95rem;
      background: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: rgba(0, 102, 204, 0.08);
    }

    th, td {
      padding: 12px 14px;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
      font-size: 0.95rem;
      vertical-align: middle;
    }

    th {
      font-weight: 600;
      color: var(--brand-blue-dark);
    }

    tbody tr:hover {
      background: rgba(0, 102, 204, 0.05);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
      background: rgba(0, 102, 204, 0.12);
      color: var(--brand-blue-dark);
    }

    .empty-state {
      padding: 36px 0;
      text-align: center;
      color: var(--text-muted);
      font-size: 1rem;
    }

    .empty-state i {
      font-size: 2.4rem;
      margin-bottom: 16px;
      color: rgba(0, 102, 204, 0.35);
    }

    .confirm-btn {
      padding: 10px 20px;
      background: var(--brand-blue);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 102, 204, 0.2);
    }

    .confirm-btn:hover {
      background: var(--brand-blue-dark);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
    }

    .confirm-btn:active {
      transform: translateY(0);
    }

    .confirm-btn:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-muted);
    }

    .loading .spinner {
      width: 18px;
      height: 18px;
      border: 3px solid rgba(0, 102, 204, 0.2);
      border-top-color: var(--brand-blue);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @media (max-width: 768px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }

      main {
        padding: 0 16px;
      }

      .filter-bar select,
      .filter-bar input {
        min-width: 100%;
      }

      table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <h1>
        <button id="menu-btn" title="é¸å–®" role="button" tabindex="0" aria-label="é–‹å•Ÿå´é‚Šé¸å–®">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div class="header-title">åª’åˆçµæœç¢ºèª</div>
        <div style="width: 30px;"></div> <!-- ä½”ä½å…ƒç´ ï¼Œä¿æŒæ¨™é¡Œç½®ä¸­ -->
      </h1>
    </div>
  </header>

  <!-- å´é‚Šé¸å–® -->
  <nav id="side-menu" aria-hidden="true" role="navigation" aria-label="åŠŸèƒ½é¸å–®">
    <button id="close-btn" aria-label="é—œé–‰åŠŸèƒ½é¸å–®">Ã—</button>
    <h2>åŠŸèƒ½é¸å–®</h2>
    <a href="/vendor_home">é¦–é </a>
    <a href="/profile">å€‹äººè³‡æ–™</a>
    <a href="/vendor_review_resume">å­¸ç”Ÿå±¥æ­·å¯©æ ¸</a>
    <a href="/manage_positions">è·ä½éœ€æ±‚ç®¡ç†</a>
    <a href="/confirm_matching">åª’åˆçµæœ</a>
    <a href="/publish_announcements">ç™¼å¸ƒå…¬å‘Š</a>
    <a href="/reviews_resumes_notifications">æŸ¥çœ‹å±¥æ­·èˆ‡é€šçŸ¥</a>
    <a href="/logout">ç™»å‡º</a>
  </nav>

  <main>
    <section class="panel" aria-label="åª’åˆæ‘˜è¦">
      <div class="panel-header">
        <h2><i class="fa-solid fa-chart-pie"></i>åª’åˆæ‘˜è¦</h2>
      </div>
      <div id="summaryContent" class="summary-grid">
        <div class="summary-item">
          <span>å…¬å¸è·ç¼ºæ•¸</span>
          <span id="summaryJobCount">-</span>
        </div>
        <div class="summary-item">
          <span>åª’åˆå­¸ç”Ÿæ•¸</span>
          <span id="summaryStudentCount">-</span>
        </div>
      </div>
      <div id="companyBreakdown" class="summary-grid" style="margin-top: 8px;"></div>
    </section>

    <section class="panel" aria-label="åª’åˆå­¸ç”Ÿåˆ—è¡¨">
      <div class="panel-header">
        <h2><i class="fa-solid fa-users-gear"></i>åª’åˆå­¸ç”Ÿåˆ—è¡¨</h2>
      </div>
      <div class="filter-bar">
        <label for="companyFilter">é¸æ“‡è·ç¼º</label>
        <select id="companyFilter">
          <option value="">é¸æ“‡è·ç¼º</option>
        </select>

        <label for="keywordInput">æœå°‹å­¸ç”Ÿå§“å</label>
        <input id="keywordInput" type="search" placeholder="è¼¸å…¥å­¸ç”Ÿå§“å">
        
        <button id="confirmMatchingBtn" class="confirm-btn" style="margin-left: auto;">
          <i class="fa-solid fa-check-circle"></i> ç¢ºèªåª’åˆçµæœ
        </button>
      </div>

      <div id="tableContainer" class="table-wrapper">
        <div class="loading" id="loadingState">
          <span class="spinner"></span> è³‡æ–™è¼‰å…¥ä¸­...
        </div>
      </div>
    </section>
  </main>

  <script>
    const positionFilter = document.getElementById('companyFilter');
    const keywordInput = document.getElementById('keywordInput');
    const summaryJobCount = document.getElementById('summaryJobCount');
    const summaryStudentCount = document.getElementById('summaryStudentCount');
    const summaryGrid = document.getElementById('companyBreakdown');
    const tableContainer = document.getElementById('tableContainer');
    const confirmMatchingBtn = document.getElementById('confirmMatchingBtn');

    let cachedMatches = [];
    let vendorJobs = [];
    let totalJobCount = 0; // å¾è·ä½éœ€æ±‚ç®¡ç†é é¢ç²å–çš„è·ç¼ºç¸½æ•¸
    let hasLoadedPositions = false; // æ¨™è¨˜æ˜¯å¦å·²ç¶“åŠ è¼‰éè·ä½æ•¸æ“š
    let currentSummary = null; // ä¿å­˜ç•¶å‰çš„æ‘˜è¦æ•¸æ“š
    let studentResumes = []; // å¾å­¸ç”Ÿå±¥æ­·APIç²å–çš„å­¸ç”Ÿåˆ—è¡¨

    async function loadVendorPositions() {
      if (!positionFilter) return;
      positionFilter.innerHTML = '<option value="">è¼‰å…¥è·ç¼ºä¸­...</option>';
      try {
        const res = await fetch('/vendor/api/positions', {
          headers: { 'Accept': 'application/json' },
          credentials: 'include'
        });
        const data = await res.json();
        if (!res.ok || !data.success) {
          throw new Error(data.message || 'è¼‰å…¥è·ç¼ºå¤±æ•—');
        }
        vendorJobs = data.items || [];
        // å¾è·ä½éœ€æ±‚ç®¡ç†APIç²å–è·ç¼ºç¸½æ•¸
        totalJobCount = (data.stats && typeof data.stats.total === 'number') ? data.stats.total : vendorJobs.length;
        hasLoadedPositions = true; // æ¨™è¨˜å·²åŠ è¼‰è·ä½æ•¸æ“š
        
        positionFilter.innerHTML = '<option value="">é¸æ“‡è·ç¼º</option>';
        const fragment = document.createDocumentFragment();
        vendorJobs.forEach(job => {
          if (!job || typeof job.id === 'undefined') {
            return;
          }
          const option = document.createElement('option');
          option.value = job.id;
          option.textContent = job.title || 'æœªå‘½åè·ç¼º';
          fragment.appendChild(option);
        });
        positionFilter.appendChild(fragment);
        
        // å¦‚æœå·²ç¶“æœ‰æ‘˜è¦æ•¸æ“šï¼Œé‡æ–°æ¸²æŸ“æ‘˜è¦ä»¥æ›´æ–°è·ç¼ºæ•¸
        if (currentSummary) {
          renderSummary(currentSummary);
        } else {
          // å¦å‰‡ç›´æ¥æ›´æ–°è·ç¼ºæ•¸
          if (summaryJobCount) {
            summaryJobCount.textContent = totalJobCount;
          }
        }
      } catch (error) {
        console.error('è¼‰å…¥è·ç¼ºæ¸…å–®å¤±æ•—:', error);
        positionFilter.innerHTML = '<option value="">é¸æ“‡è·ç¼º</option>';
      }
    }

    function calculateJobCount(summary) {
      // å„ªå…ˆä½¿ç”¨å¾è·ä½éœ€æ±‚ç®¡ç†é é¢ç²å–çš„è·ç¼ºæ•¸
      if (hasLoadedPositions) {
        return totalJobCount;
      }
      // å‚™ç”¨æ–¹æ¡ˆï¼šå¾æ‘˜è¦ä¸­ç²å–
      if (summary && typeof summary.total_jobs === 'number') {
        return summary.total_jobs;
      }
      // æœ€å¾Œå‚™ç”¨æ–¹æ¡ˆï¼šå¾åª’åˆçµæœä¸­è¨ˆç®—
      const jobKeys = new Set();
      cachedMatches.forEach(item => {
        const jobId = item.job_id;
        if (jobId) {
          jobKeys.add(`job-${jobId}`);
        } else {
          const fallbackKey = `${item.company_id || 'company'}-${item.job_title || ''}`;
          jobKeys.add(fallbackKey);
        }
      });
      return jobKeys.size;
    }

    async function loadStudentResumes() {
      try {
        // å°æ–¼å» å•†ï¼Œä½¿ç”¨ vendor_matching_results API ç²å–æ‰€æœ‰ç‹€æ…‹ç‚º approved çš„å­¸ç”Ÿå±¥æ­·
        // é€™å€‹ API æœƒè¿”å›æ‰€æœ‰ç‹€æ…‹ç‚º approved çš„å­¸ç”Ÿå±¥æ­·ï¼Œç”¨æ–¼çµ±è¨ˆåª’åˆå­¸ç”Ÿæ•¸
        const res = await fetch('/admission/api/vendor_matching_results', {
          headers: { 'Accept': 'application/json' },
          credentials: 'include'
        });
        const data = await res.json();
        if (res.ok && data.success) {
          // å¾åª’åˆçµæœä¸­æå–å­¸ç”Ÿå±¥æ­·ä¿¡æ¯
          const matches = data.matches || [];
          studentResumes = matches.map(match => ({
            student_number: match.student_number,
            student_name: match.student_name,
            name: match.student_name,
            username: match.student_number,
            user_id: match.student_id,
            status: 'approved', // é€™äº›éƒ½æ˜¯ç‹€æ…‹ç‚º approved çš„å­¸ç”Ÿå±¥æ­·
            class_name: match.class_name,
            company_name: match.company_name
          }));
          // å¦‚æœæœ‰å·²ä¿å­˜çš„æ‘˜è¦ï¼Œé‡æ–°æ¸²æŸ“ä»¥æ›´æ–°å­¸ç”Ÿæ•¸
          if (currentSummary) {
            renderSummary(currentSummary);
          }
        } else {
          // å¦‚æœ vendor_matching_results API å¤±æ•—ï¼Œå›é€€åˆ°åŸä¾†çš„ API
          const fallbackRes = await fetch('/api/get_class_resumes', {
            headers: { 'Accept': 'application/json' },
            credentials: 'include'
          });
          const fallbackData = await fallbackRes.json();
          if (fallbackRes.ok && fallbackData.success) {
            studentResumes = fallbackData.resumes || [];
            // åªçµ±è¨ˆç‹€æ…‹ç‚º approved çš„å­¸ç”Ÿå±¥æ­·
            studentResumes = studentResumes.filter(resume => resume.status === 'approved');
            if (currentSummary) {
              renderSummary(currentSummary);
            }
          }
        }
      } catch (error) {
        console.error('è¼‰å…¥å­¸ç”Ÿå±¥æ­·å¤±æ•—:', error);
      }
    }

    function calculateStudentCount() {
      // å„ªå…ˆå¾åª’åˆçµæœä¸­è¨ˆç®—ï¼ˆé€™äº›æ˜¯ç‹€æ…‹ç‚º approved çš„å­¸ç”Ÿï¼‰
      if (cachedMatches && cachedMatches.length > 0) {
        const uniqueStudents = new Set();
        cachedMatches.forEach(match => {
          const studentId = match.student_id || match.student_number;
          if (studentId) {
            uniqueStudents.add(String(studentId));
          }
        });
        return uniqueStudents.size;
      }
      // å‚™ç”¨æ–¹æ¡ˆï¼šå¾å­¸ç”Ÿå±¥æ­·APIç²å–çš„å­¸ç”Ÿæ•¸é‡ï¼ˆå»é‡ï¼Œæ¯å€‹å­¸ç”Ÿåªè¨ˆç®—ä¸€æ¬¡ï¼‰
      // æ³¨æ„ï¼šé€™è£¡åªçµ±è¨ˆç‹€æ…‹ç‚º approved çš„å­¸ç”Ÿå±¥æ­·
      if (studentResumes && studentResumes.length > 0) {
        const uniqueStudents = new Set();
        studentResumes.forEach(resume => {
          // åªçµ±è¨ˆç‹€æ…‹ç‚º approved çš„å­¸ç”Ÿå±¥æ­·
          if (resume.status === 'approved') {
            const studentId = resume.student_number || resume.username || resume.user_id;
            if (studentId) {
              uniqueStudents.add(String(studentId));
            }
          }
        });
        return uniqueStudents.size;
      }
      return 0;
    }

    function renderSummary(summary) {
      // ä¿å­˜æ‘˜è¦æ•¸æ“šï¼Œä»¥ä¾¿åœ¨è·ä½æ•¸æ“šåŠ è¼‰å®Œæˆå¾Œå¯ä»¥é‡æ–°æ¸²æŸ“
      currentSummary = summary || {};
      
      const jobCount = calculateJobCount(summary);
      summaryJobCount.textContent = jobCount;
      
      // å¾å­¸ç”Ÿå±¥æ­·APIç²å–å­¸ç”Ÿæ•¸
      const studentCount = calculateStudentCount();
      summaryStudentCount.textContent = studentCount || summary.total_students || 0;

      summaryGrid.innerHTML = '';
      if (summary.by_company && summary.by_company.length) {
        summary.by_company.forEach(item => {
          const block = document.createElement('div');
          block.className = 'summary-item';
          block.innerHTML = `
            <span>${item.company_name}</span>
            <span>${item.matched_students}</span>
          `;
          summaryGrid.appendChild(block);
        });
      }
    }

    function renderTable(matches) {
      // æ›´æ–°ç¢ºèªæŒ‰éˆ•ç‹€æ…‹
      if (confirmMatchingBtn) {
        if (!matches || matches.length === 0) {
          confirmMatchingBtn.disabled = true;
          confirmMatchingBtn.style.opacity = '0.5';
        } else {
          confirmMatchingBtn.disabled = false;
          confirmMatchingBtn.style.opacity = '1';
        }
      }

      if (!matches.length) {
        tableContainer.innerHTML = `
          <div class="empty-state">
            <i class="fa-solid fa-circle-info"></i>
            <div>å°šç„¡åª’åˆç´€éŒ„æˆ–å°šæœªèˆ‡ä»»ä½•å…¬å¸é—œè¯ã€‚</div>
          </div>
        `;
        return;
      }

      const rowsHtml = matches.map(row => `
        <tr style="border-bottom: 1px solid #e2e8f0;">
          <td style="padding: 14px 16px; vertical-align: middle;">
            <div style="font-weight:600;">${row.student_name || '-'}</div>
            <div style="font-size:0.85rem;color:#64748b;">${row.student_number || ''}</div>
          </td>
          <td style="padding: 14px 16px; vertical-align: middle;">${row.class_department ? `${row.class_department}${row.class_name || ''}` : (row.class_name || '-')}</td>
          <td style="padding: 14px 16px; vertical-align: middle;">${row.student_email || '-'}</td>
          <td style="padding: 14px 16px; vertical-align: middle;">
            <div style="font-weight:600;">${row.company_name}</div>
            <div class="badge"><i class="fa-solid fa-briefcase"></i>${row.job_title || 'æœªæŒ‡å®šè·ç¼º'}</div>
          </td>
          <td style="padding: 14px 16px; vertical-align: middle;">
            <div style="font-size:0.85rem;color:#64748b;">å­¸æœŸï¼š${row.semester || '-'}</div>
          </td>
        </tr>
      `).join('');

      tableContainer.innerHTML = `
        <table style="width: 100%; border-collapse: collapse; min-width: 1000px;">
          <thead style="background: #f1f5f9;">
            <tr>
              <th style="padding: 14px 16px; text-align: left; border-bottom: 1px solid #e2e8f0; font-weight: 600;">å­¸ç”Ÿ</th>
              <th style="padding: 14px 16px; text-align: left; border-bottom: 1px solid #e2e8f0; font-weight: 600;">ç­ç´š</th>
              <th style="padding: 14px 16px; text-align: left; border-bottom: 1px solid #e2e8f0; font-weight: 600;">Email</th>
              <th style="padding: 14px 16px; text-align: left; border-bottom: 1px solid #e2e8f0; font-weight: 600;">åª’åˆå…¬å¸ / è·ç¼º</th>
              <th style="padding: 14px 16px; text-align: left; border-bottom: 1px solid #e2e8f0; font-weight: 600;">åª’åˆè³‡è¨Š</th>
            </tr>
          </thead>
          <tbody>${rowsHtml}</tbody>
        </table>
      `;
    }

    function applyFilters() {
      const selectedJob = positionFilter.value;
      const keyword = keywordInput.value.trim().toLowerCase();

      // æ§‹å»ºå­¸ç”Ÿå±¥æ­·çš„å§“åæ˜ å°„è¡¨ï¼ˆç”¨æ–¼æœç´¢ï¼‰
      let studentNameMap = new Map(); // key: student_number, value: student_name
      if (studentResumes && studentResumes.length > 0) {
        studentResumes.forEach(resume => {
          const studentId = resume.student_number || resume.username;
          const studentName = resume.student_name || resume.name;
          if (studentId && studentName) {
            studentNameMap.set(String(studentId), studentName.toLowerCase());
          }
        });
      }
      
      const filtered = cachedMatches.filter(item => {
        const matchJob = !selectedJob || (item.job_id && String(item.job_id) === selectedJob);
        
        const studentNumber = String(item.student_number || '');
        
        // å¦‚æœå­¸ç”Ÿå±¥æ­·åˆ—è¡¨å·²åŠ è¼‰ï¼Œåªé¡¯ç¤ºåœ¨åˆ—è¡¨ä¸­çš„å­¸ç”Ÿ
        if (studentNameMap.size > 0) {
          const studentNameFromResume = studentNameMap.get(studentNumber);
          // å¦‚æœå­¸ç”Ÿä¸åœ¨å±¥æ­·åˆ—è¡¨ä¸­ï¼Œéæ¿¾æ‰
          if (!studentNameFromResume) {
            return false;
          }
          // å¦‚æœæœ‰æœç´¢é—œéµå­—ï¼Œæª¢æŸ¥å­¸ç”Ÿå§“åæ˜¯å¦åŒ¹é…
          if (keyword) {
            return matchJob && studentNameFromResume.includes(keyword);
          }
          // æ²’æœ‰æœç´¢é—œéµå­—ï¼Œåªæª¢æŸ¥è·ç¼ºåŒ¹é…
          return matchJob;
        }
        
        // å¦‚æœå±¥æ­·åˆ—è¡¨æœªåŠ è¼‰ï¼Œä½¿ç”¨åŸä¾†çš„é‚è¼¯
        if (keyword) {
          return matchJob && (item.student_name && item.student_name.toLowerCase().includes(keyword));
        }
        return matchJob;
      });

      renderTable(filtered);
    }

    async function loadMatchingResults() {
      try {
        // ä½¿ç”¨èˆ‡ç§‘åŠ© /ta/match_results ç›¸åŒçš„è³‡æ–™ä¾†æº
        // 1. ç²å–æ‰€æœ‰å·²å¯©æ ¸çš„å…¬å¸
        const companiesRes = await fetch('/api/get_reviewed_companies', {
          headers: { 'Accept': 'application/json' },
          credentials: 'include'
        });

        if (!companiesRes.ok) {
          throw new Error('ç„¡æ³•è¼‰å…¥å…¬å¸åˆ—è¡¨');
        }

        const companiesData = await companiesRes.json();
        if (!companiesData.success || !companiesData.companies || companiesData.companies.length === 0) {
          tableContainer.innerHTML = `
            <div class="empty-state">
              <i class="fa-solid fa-circle-info"></i>
              <div>ç›®å‰æ²’æœ‰å·²å¯©æ ¸çš„å…¬å¸</div>
            </div>
          `;
          renderSummary({ total_jobs: 0, total_students: 0, by_company: [] });
          return;
        }

        const companies = companiesData.companies;
        const allMatches = [];
        const companyBreakdown = [];

        // 2. å°æ–¼æ¯å€‹å…¬å¸ï¼Œç²å–ä»–å€‘å¯©æ ¸é€šéçš„å­¸ç”Ÿå’Œè·ç¼º
        for (const company of companies) {
          let approvedStudents = [];
          let jobs = [];
          
          // ç²å–è·ç¼ºåˆ—è¡¨
          try {
            const jobsRes = await fetch(`/intern_experience/api/jobs/${company.id}`, {
              headers: { 'Accept': 'application/json' },
              credentials: 'include'
            });

            if (jobsRes.ok) {
              const jobsData = await jobsRes.json();
              if (jobsData.success && jobsData.data) {
                jobs = jobsData.data;
              }
            }
          } catch (error) {
            console.error(`è¼‰å…¥å…¬å¸ ${company.company_name} çš„è·ç¼ºå¤±æ•—:`, error);
          }
          
          // ç²å–å¯©æ ¸é€šéçš„å­¸ç”Ÿ
          try {
            const studentsRes = await fetch(`/api/public/company/${company.id}/vendor-reviewed-students`, {
              headers: { 'Accept': 'application/json' },
              credentials: 'include'
            });

            if (studentsRes.ok) {
              const studentsData = await studentsRes.json();
              if (studentsData.success && studentsData.students && studentsData.students.length > 0) {
                // åªä¿ç•™å¯©æ ¸é€šéçš„å­¸ç”Ÿ
                approvedStudents = studentsData.students.filter(s => s.vendor_review_status === 'approved');
              }
            }
          } catch (error) {
            console.error(`è¼‰å…¥å…¬å¸ ${company.company_name} çš„å­¸ç”Ÿå¤±æ•—:`, error);
          }
          
          // ç²å–åª’åˆæ’åºçµæœï¼ˆå¦‚æœæœ‰ï¼‰
          try {
            console.log(`ğŸ” æ­£åœ¨ç‚ºå…¬å¸ ${company.company_name} (ID: ${company.id}) ç²å–åª’åˆæ’åºçµæœ...`);
            const matchingSortRes = await fetch('/vendor/api/get_matching_sort', {
              headers: { 'Accept': 'application/json' },
              credentials: 'include'
            });
            
            if (matchingSortRes.ok) {
              const matchingSortData = await matchingSortRes.json();
              console.log('ğŸ“Š åª’åˆæ’åºAPIå›æ‡‰:', matchingSortData);
              
              if (matchingSortData.success && matchingSortData.results && matchingSortData.results.length > 0) {
                console.log(`ğŸ“‹ æ‰¾åˆ° ${matchingSortData.results.length} ç­†åª’åˆæ’åºè¨˜éŒ„`);
                // éæ¿¾å‡ºè©²å…¬å¸çš„åª’åˆæ’åºçµæœ
                const companyMatchingSort = matchingSortData.results.filter(r => {
                  const match = (r.company_id === company.id) || (String(r.company_id) === String(company.id));
                  return match;
                });
                console.log(`ğŸ“‹ å…¬å¸ ${company.company_name} (ID: ${company.id}) çš„åª’åˆæ’åºè¨˜éŒ„: ${companyMatchingSort.length} ç­†`);
                
                if (companyMatchingSort.length > 0) {
                  // å»ºç«‹åª’åˆæ’åºæ˜ å°„è¡¨ï¼ˆæŒ‰è·ç¼ºåˆ†çµ„ï¼‰
                  const matchingSortMap = new Map(); // key: job_id, value: {æ­£å–: [], å€™è£œ: []}
                  
                  companyMatchingSort.forEach(item => {
                    const jobId = item.job_id || 'no_job';
                    if (!matchingSortMap.has(jobId)) {
                      matchingSortMap.set(jobId, {æ­£å–: [], å€™è£œ: []});
                    }
                    
                    if (item.is_reserve) {
                      matchingSortMap.get(jobId).å€™è£œ.push(item);
                    } else {
                      matchingSortMap.get(jobId).æ­£å–.push(item);
                    }
                  });
                  
                  // æŒ‰è·ç¼ºå’Œæ’åºçµæœé‡æ–°çµ„ç¹”å­¸ç”Ÿåˆ—è¡¨
                  const sortedStudents = [];
                  const matchedStudentIds = new Set();
                  
                  // å…ˆæ·»åŠ æœ‰åª’åˆæ’åºçš„å­¸ç”Ÿï¼ˆæŒ‰è·ç¼ºå’Œæ’åºï¼‰
                  matchingSortMap.forEach((sortData, jobId) => {
                    // å…ˆæ·»åŠ æ­£å–å­¸ç”Ÿï¼ˆæŒ‰ slot_index æ’åºï¼‰
                    sortData.æ­£å–.sort((a, b) => {
                      const slotA = a.slot_index || 999;
                      const slotB = b.slot_index || 999;
                      return slotA - slotB;
                    });
                    
                    sortData.æ­£å–.forEach(item => {
                      // å˜—è©¦å¤šç¨®æ–¹å¼åŒ¹é…å­¸ç”Ÿ
                      let student = approvedStudents.find(s => {
                        if (s.student_id && item.student_id && String(s.student_id) === String(item.student_id)) {
                          return true;
                        }
                        if (s.id && item.student_id && String(s.id) === String(item.student_id)) {
                          return true;
                        }
                        if (s.student_number && item.student_number && s.student_number === item.student_number) {
                          return true;
                        }
                        if (s.username && item.student_number && s.username === item.student_number) {
                          return true;
                        }
                        return false;
                      });
                      
                      if (student) {
                        // æ›´æ–°å­¸ç”Ÿçš„è·ç¼ºä¿¡æ¯ç‚ºåª’åˆæ’åºä¸­çš„è·ç¼º
                        if (item.job_title) {
                          student.job_title = item.job_title;
                          student.job_id = item.job_id;
                        }
                        sortedStudents.push(student);
                        matchedStudentIds.add(String(item.student_id));
                      } else {
                        // å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„å­¸ç”Ÿï¼Œå¾åª’åˆæ’åºæ•¸æ“šå‰µå»ºå­¸ç”Ÿå°è±¡
                        console.warn(`âš ï¸ ç„¡æ³•åœ¨å¯©æ ¸åˆ—è¡¨ä¸­åŒ¹é…æ­£å–å­¸ç”Ÿï¼Œå¾åª’åˆæ’åºæ•¸æ“šå‰µå»º:`, item);
                        const newStudent = {
                          student_id: item.student_id,
                          student_name: item.student_name || 'æœªçŸ¥',
                          student_number: item.student_number || '',
                          student_email: item.student_email || '',
                          class_name: item.class_name || '',
                          class_department: item.class_department || '',
                          vendor_review_status: 'approved',
                          job_title: item.job_title || '',
                          job_id: item.job_id || null
                        };
                        sortedStudents.push(newStudent);
                        matchedStudentIds.add(String(item.student_id));
                      }
                    });
                    
                    // å†æ·»åŠ å€™è£œå­¸ç”Ÿ
                    sortData.å€™è£œ.forEach(item => {
                      let student = approvedStudents.find(s => {
                        if (s.student_id && item.student_id && String(s.student_id) === String(item.student_id)) {
                          return true;
                        }
                        if (s.id && item.student_id && String(s.id) === String(item.student_id)) {
                          return true;
                        }
                        if (s.student_number && item.student_number && s.student_number === item.student_number) {
                          return true;
                        }
                        if (s.username && item.student_number && s.username === item.student_number) {
                          return true;
                        }
                        return false;
                      });
                      
                      const studentIdStr = String(item.student_id);
                      if (student && !matchedStudentIds.has(studentIdStr)) {
                        // æ›´æ–°å­¸ç”Ÿçš„è·ç¼ºä¿¡æ¯ç‚ºåª’åˆæ’åºä¸­çš„è·ç¼º
                        if (item.job_title) {
                          student.job_title = item.job_title;
                          student.job_id = item.job_id;
                        }
                        sortedStudents.push(student);
                        matchedStudentIds.add(studentIdStr);
                      } else if (!student && !matchedStudentIds.has(studentIdStr)) {
                        // å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„å­¸ç”Ÿï¼Œå¾åª’åˆæ’åºæ•¸æ“šå‰µå»ºå­¸ç”Ÿå°è±¡
                        console.warn(`âš ï¸ ç„¡æ³•åœ¨å¯©æ ¸åˆ—è¡¨ä¸­åŒ¹é…å€™è£œå­¸ç”Ÿï¼Œå¾åª’åˆæ’åºæ•¸æ“šå‰µå»º:`, item);
                        const newStudent = {
                          student_id: item.student_id,
                          student_name: item.student_name || 'æœªçŸ¥',
                          student_number: item.student_number || '',
                          student_email: item.student_email || '',
                          class_name: item.class_name || '',
                          class_department: item.class_department || '',
                          vendor_review_status: 'approved',
                          job_title: item.job_title || '',
                          job_id: item.job_id || null
                        };
                        sortedStudents.push(newStudent);
                        matchedStudentIds.add(studentIdStr);
                      }
                    });
                  });
                  
                  // æ·»åŠ æ²’æœ‰åª’åˆæ’åºçš„å­¸ç”Ÿï¼ˆæŒ‰å¯©æ ¸æ™‚é–“æ’åºï¼‰
                  approvedStudents.forEach(student => {
                    const studentIdStr = String(student.student_id || student.id || '');
                    if (!matchedStudentIds.has(studentIdStr)) {
                      sortedStudents.push(student);
                    }
                  });
                  
                  approvedStudents = sortedStudents;
                  console.log(`âœ… ä½¿ç”¨åª’åˆæ’åºçµæœï¼Œå…± ${approvedStudents.length} ä½å­¸ç”Ÿ`);
                } else {
                  console.log(`âš ï¸ å…¬å¸ ${company.company_name} æ²’æœ‰åª’åˆæ’åºè¨˜éŒ„ï¼Œä½¿ç”¨å¯©æ ¸æ™‚é–“æ’åº`);
                  // å¦‚æœæ²’æœ‰åª’åˆæ’åºçµæœï¼ŒæŒ‰å¯©æ ¸æ™‚é–“æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
                  approvedStudents.sort((a, b) => {
                    const timeA = new Date(a.vendor_reviewed_at || 0);
                    const timeB = new Date(b.vendor_reviewed_at || 0);
                    return timeB - timeA; // é™åºï¼šæœ€æ–°çš„åœ¨å‰
                  });
                }
              } else {
                console.log(`âš ï¸ åª’åˆæ’åºAPIè¿”å›ç©ºçµæœï¼Œä½¿ç”¨å¯©æ ¸æ™‚é–“æ’åº`);
                // å¦‚æœæ²’æœ‰åª’åˆæ’åºçµæœï¼ŒæŒ‰å¯©æ ¸æ™‚é–“æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
                approvedStudents.sort((a, b) => {
                  const timeA = new Date(a.vendor_reviewed_at || 0);
                  const timeB = new Date(b.vendor_reviewed_at || 0);
                  return timeB - timeA; // é™åºï¼šæœ€æ–°çš„åœ¨å‰
                });
              }
            }
          } catch (error) {
            console.error(`âŒ è¼‰å…¥åª’åˆæ’åºçµæœå¤±æ•—:`, error);
            // å¦‚æœç²å–åª’åˆæ’åºå¤±æ•—ï¼ŒæŒ‰å¯©æ ¸æ™‚é–“æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            approvedStudents.sort((a, b) => {
              const timeA = new Date(a.vendor_reviewed_at || 0);
              const timeB = new Date(b.vendor_reviewed_at || 0);
              return timeB - timeA; // é™åºï¼šæœ€æ–°çš„åœ¨å‰
            });
          }

          // å°‡å­¸ç”Ÿè³‡æ–™è½‰æ›æˆ matches æ ¼å¼
          approvedStudents.forEach(student => {
            allMatches.push({
              student_id: student.student_id,
              student_name: student.student_name,
              student_number: student.student_number,
              student_email: student.student_email || '',
              class_name: student.class_name || '',
              class_department: student.class_department || '',
              company_id: company.id,
              company_name: company.company_name,
              job_id: student.job_id || null,
              job_title: student.job_title || 'æœªæŒ‡å®šè·ç¼º',
              preference_order: student.preference_order || null,
              admitted_at: student.vendor_reviewed_at || null,
              semester: '1132' // é è¨­å­¸æœŸ
            });
          });

          // å»ºç«‹å…¬å¸æ‘˜è¦
          if (approvedStudents.length > 0) {
            companyBreakdown.push({
              company_name: company.company_name,
              matched_students: approvedStudents.length
            });
          }
        }

        // 3. æ›´æ–°å¿«å–å’Œæ‘˜è¦
        cachedMatches = allMatches;
        const summary = {
          total_jobs: totalJobCount || 0,
          total_students: allMatches.length,
          by_company: companyBreakdown
        };
        renderSummary(summary);

        if (allMatches.length === 0) {
          tableContainer.innerHTML = `
            <div class="empty-state">
              <i class="fa-solid fa-circle-info"></i>
              <div>ç›®å‰æ²’æœ‰å¯©æ ¸é€šéçš„å­¸ç”Ÿ</div>
            </div>
          `;
          return;
        }

        applyFilters();
      } catch (error) {
        console.error('åª’åˆçµæœè¼‰å…¥å¤±æ•—:', error);
        tableContainer.innerHTML = `
          <div class="empty-state">
            <i class="fa-solid fa-triangle-exclamation"></i>
            <div>åª’åˆçµæœè¼‰å…¥å¤±æ•—ï¼š${error.message}</div>
          </div>
        `;
      }
    }

    positionFilter.addEventListener('change', applyFilters);
    keywordInput.addEventListener('input', () => {
      window.clearTimeout(keywordInput._timer);
      keywordInput._timer = setTimeout(applyFilters, 220);
    });

    // ç¢ºèªåª’åˆçµæœåŠŸèƒ½ï¼ˆåªç¢ºèªåŒä¸€é–“å…¬å¸çš„å­¸ç”Ÿï¼‰
    if (confirmMatchingBtn) {
      confirmMatchingBtn.addEventListener('click', async function() {
        // ç²å–ç•¶å‰é¡¯ç¤ºçš„å­¸ç”Ÿï¼ˆç¶“éç¯©é¸å¾Œçš„ï¼‰
        const selectedJob = positionFilter.value;
        const keyword = keywordInput.value.trim().toLowerCase();
        
        // æ§‹å»ºå­¸ç”Ÿå±¥æ­·çš„å§“åæ˜ å°„è¡¨ï¼ˆç”¨æ–¼æœç´¢ï¼‰
        let studentNameMap = new Map();
        if (studentResumes && studentResumes.length > 0) {
          studentResumes.forEach(resume => {
            const studentId = resume.student_number || resume.username;
            const studentName = resume.student_name || resume.name;
            if (studentId && studentName) {
              studentNameMap.set(String(studentId), studentName.toLowerCase());
            }
          });
        }
        
        // æ‡‰ç”¨èˆ‡ applyFilters ç›¸åŒçš„éæ¿¾é‚è¼¯
        const filteredMatches = cachedMatches.filter(item => {
          const matchJob = !selectedJob || (item.job_id && String(item.job_id) === selectedJob);
          
          const studentNumber = String(item.student_number || '');
          
          if (studentNameMap.size > 0) {
            const studentNameFromResume = studentNameMap.get(studentNumber);
            if (!studentNameFromResume) {
              return false;
            }
            if (keyword) {
              return matchJob && studentNameFromResume.includes(keyword);
            }
            return matchJob;
          }
          
          if (keyword) {
            return matchJob && (item.student_name && item.student_name.toLowerCase().includes(keyword));
          }
          return matchJob;
        });

        if (!filteredMatches || filteredMatches.length === 0) {
          alert('ç›®å‰æ²’æœ‰åª’åˆå­¸ç”Ÿï¼Œç„¡æ³•ç¢ºèªåª’åˆçµæœ');
          return;
        }

        // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰å­¸ç”Ÿéƒ½å±¬æ–¼åŒä¸€é–“å…¬å¸
        const companyIds = new Set(filteredMatches.map(m => m.company_id).filter(id => id));
        if (companyIds.size === 0) {
          alert('ç„¡æ³•ç¢ºèªï¼šæ‰¾ä¸åˆ°å…¬å¸è³‡è¨Š');
          return;
        }
        if (companyIds.size > 1) {
          const companyNames = [...new Set(filteredMatches.map(m => m.company_name).filter(name => name))];
          alert(`ç„¡æ³•ç¢ºèªï¼šç›®å‰é¡¯ç¤ºçš„å­¸ç”Ÿä¾†è‡ªå¤šé–“å…¬å¸ï¼ˆ${companyNames.join('ã€')}ï¼‰\n\nè«‹å…ˆä½¿ç”¨ç¯©é¸åŠŸèƒ½ï¼Œåªé¡¯ç¤ºåŒä¸€é–“å…¬å¸çš„å­¸ç”Ÿå¾Œå†ç¢ºèªã€‚`);
          return;
        }

        const companyId = Array.from(companyIds)[0];
        const companyName = filteredMatches[0].company_name || 'è©²å…¬å¸';
        const studentCount = filteredMatches.length;

        if (!confirm(`ç¢ºå®šè¦ç¢ºèªã€Œ${companyName}ã€çš„ ${studentCount} ä½å­¸ç”Ÿåª’åˆçµæœå—ï¼Ÿ\n\nç¢ºèªå¾Œï¼Œé€™äº›å­¸ç”Ÿå°‡å¯ä»¥åœ¨å¯¦ç¿’æˆæœé é¢çœ‹åˆ°ç›¸é—œè³‡è¨Šã€‚`)) {
          return;
        }

        confirmMatchingBtn.disabled = true;
        confirmMatchingBtn.innerHTML = '<span class="spinner"></span> ç¢ºèªä¸­...';

        let successCount = 0;
        let failCount = 0;
        const errors = [];

        // åªç¢ºèªåŒä¸€é–“å…¬å¸çš„å­¸ç”Ÿ
        for (const match of filteredMatches) {
          // å†æ¬¡ç¢ºèªå…¬å¸IDä¸€è‡´
          if (match.company_id !== companyId) {
            continue;
          }
          try {
            const response = await fetch('/admission/api/record_admission', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              credentials: 'include',
              body: JSON.stringify({
                student_id: match.student_id,
                company_id: match.company_id,
                job_id: match.job_id || null,
                preference_order: match.preference_order || null
              })
            });

            const data = await response.json();
            if (data.success) {
              successCount++;
            } else {
              failCount++;
              errors.push(`${match.student_name}: ${data.message || 'æœªçŸ¥éŒ¯èª¤'}`);
            }
          } catch (error) {
            failCount++;
            errors.push(`${match.student_name}: ç¶²è·¯éŒ¯èª¤`);
            console.error('ç¢ºèªåª’åˆçµæœå¤±æ•—:', error);
          }
        }

        confirmMatchingBtn.disabled = false;
        confirmMatchingBtn.innerHTML = '<i class="fa-solid fa-check-circle"></i> ç¢ºèªåª’åˆçµæœ';

        if (failCount === 0) {
          alert(`âœ… æˆåŠŸç¢ºèªã€Œ${companyName}ã€çš„ ${successCount} ä½å­¸ç”Ÿåª’åˆçµæœï¼\n\nå­¸ç”Ÿç¾åœ¨å¯ä»¥åœ¨å¯¦ç¿’æˆæœé é¢çœ‹åˆ°ç›¸é—œè³‡è¨Šã€‚`);
          // é‡æ–°è¼‰å…¥åª’åˆçµæœä»¥é¡¯ç¤ºæ›´æ–°å¾Œçš„åª’åˆæ™‚é–“
          loadMatchingResults();
        } else {
          const errorMsg = errors.length > 0 ? '\n\néŒ¯èª¤è©³æƒ…ï¼š\n' + errors.slice(0, 5).join('\n') : '';
          if (errors.length > 5) {
            errorMsg += `\n... é‚„æœ‰ ${errors.length - 5} å€‹éŒ¯èª¤`;
          }
          alert(`âš ï¸ ç¢ºèªå®Œæˆï¼šæˆåŠŸ ${successCount} ä½ï¼Œå¤±æ•— ${failCount} ä½${errorMsg}`);
          // å³ä½¿æœ‰éƒ¨åˆ†å¤±æ•—ï¼Œä¹Ÿé‡æ–°è¼‰å…¥ä»¥é¡¯ç¤ºå·²æˆåŠŸçš„è¨˜éŒ„
          loadMatchingResults();
        }
      });
    }

    // å´é‚Šé¸å–®æ§åˆ¶
    const sideMenu = document.getElementById('side-menu');
    const menuBtn = document.getElementById('menu-btn');
    const closeBtn = document.getElementById('close-btn');
    
    if (menuBtn) {
      menuBtn.addEventListener('click', () => {
        sideMenu.classList.add('open');
        sideMenu.setAttribute('aria-hidden', 'false');
      });
    }
    
    if (closeBtn) {
      closeBtn.addEventListener('click', () => {
        sideMenu.classList.remove('open');
        sideMenu.setAttribute('aria-hidden', 'true');
      });
    }
    
    document.addEventListener('click', (event) => {
      if (sideMenu && !sideMenu.contains(event.target) && menuBtn && !menuBtn.contains(event.target)) {
        sideMenu.classList.remove('open');
        sideMenu.setAttribute('aria-hidden', 'true');
      }
    });

    loadVendorPositions();
    loadStudentResumes();
    loadMatchingResults();
  </script>
</body>
</html>

