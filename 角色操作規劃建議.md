# 角色操作規劃建議

> 針對**管理員（學期管理設置）**與**科助、學生、廠商（實習媒合機制、二面機制）**的操作與權限，整理規劃建議，供實作與流程設計參考。

---

## 一、管理員 — 學期管理設置

### 1.1 現有與缺口

| 項目 | 現況 | 建議補齊 |
|------|------|----------|
| **學期 CRUD** | 已有學期列表、新增、編輯、刪除、設定當前學期、預約自動切換。 | 維持；刪除前需加「有關聯資料則禁止刪除」或改為封存。 |
| **切換前檢查** | 手動/自動切換前無檢查，直接切換。 | 切換前 API 檢查當前學期「未審核履歷／未審核志願序／待審公司」筆數；手動切換前彈出摘要與確認；自動切換前若有未完成可選擇「本輪不切換」並寫入日誌。 |
| **切換影響摘要** | 管理員/TA 不知道切換後影響範圍。 | 學期管理頁「立即切換」或「預約切換」旁顯示：新學期代碼、將關閉的舊學期、缺曠區間會變更的屆別、建議先完成事項（如審完志願）。 |
| **學期與公告/作業** | 志願序截止等依公告，與學期可能脫鉤。 | 學期管理頁顯示「當前學期」；若有「填寫志願序截止」等公告，顯示其 end_time 與學期對應，避免學期已換但公告仍寫舊學期。 |
| **自動切換日誌** | 排程是否執行、是否切換成功不易確認。 | 每次 `check_auto_switch` 寫入日誌；後台提供「最近自動切換紀錄」或「測試自動切換」（僅測試用學期）。 |
| **禁止刪除有關聯學期** | 目前可刪除非當前學期，未檢查關聯。 | 刪除前檢查該學期是否有履歷、志願序、錄取、缺曠等；若有則禁止刪除並列出關聯表與筆數，或改為「停用/封存」。 |

### 1.2 管理員操作規劃（學期管理）

| 操作 | 權限 | 建議流程 |
|------|------|----------|
| **檢視學期列表** | admin、ta | 顯示學期代碼、起迄日、當前學期標記、預約自動切換時間；標示「當前學期」與「待切換學期」。 |
| **新增/編輯學期** | 僅 admin（或 admin + ta） | 新增時檢查學期代碼不重複；編輯可改起迄日、自動切換時間。 |
| **立即切換學期** | admin、ta | ① 先呼叫「切換前檢查」API；② 若有未完成筆數，彈出摘要與「仍要切換／取消」；③ 確認後呼叫切換 API；④ 成功後顯示「已切換至 OO 學期」。 |
| **預約自動切換** | admin、ta | 選擇目標學期與日期時間，寫入 `auto_switch_at`；學期管理頁顯示「將於 OO 時間自動切換」。 |
| **刪除學期** | 僅 admin（建議） | ① 僅允許刪除「非當前」且「無關聯資料」的學期；② 若有關聯，顯示關聯表與筆數，提供「停用/封存」選項不刪除。 |
| **查看自動切換日誌** | admin、ta | 後台「學期管理」或獨立「系統日誌」區塊：最近 N 次自動切換檢查時間、是否找到待切換、切換結果。 |

---

## 二、科助 — 實習媒合機制與二面機制

### 2.1 實習媒合機制（科助）

| 操作 | 現況 | 建議規劃 |
|------|------|----------|
| **檢視媒合結果** | 已有 `final_results` 可看各廠商正取/候補與審核通過學生。 | 維持；並區分「待科助公告」與「已公告」名單。 |
| **待科助公告名單** | 無。廠商確認後直接寫入錄取。 | 新流程下：僅顯示狀態為 `director_approved` 的媒合輪次；列表為「主任已核定、待科助公告」之名單（各廠商正取/遞補後名單）。 |
| **確認即公告** | 無。 | 科助點「確認即公告」後：① 狀態改為 `ta_published`；② 依核定名單批次寫入 `internship_offers` 並發送媒合成功通知給廠商與學生；③ 前端即時更新為「已公告」，學生/廠商端可看到正式結果。 |
| **媒合結果匯出** | 可依現有資料匯出。 | 提供「本學期媒合結果」Excel 匯出（學生、志願序、錄取公司/職缺、指導老師、錄取時間），供存檔與統計。 |
| **衝突/總表檢視** | 無主任專用「媒合核定」前，科助無法代看衝突。 | 若主任未使用系統核定，科助可僅負責「確認即公告」；若未來主任有核定頁，科助不需重複處理衝突，只做最後公告。 |

### 2.2 二面機制（科助）

| 操作 | 現況 | 建議規劃 |
|------|------|----------|
| **檢視面試排程** | 目前面試排程主要為廠商端（`interview_schedule`、`schedule_interviews`）。 | 科助可檢視「全系統面試行事曆」：依學期/廠商/職缺篩選，顯示一面、二面（若有區分）之時間與學生名單。 |
| **一面/二面區分** | 目前僅有「面試排程」「標記完成」，未區分一面、二面。 | 若需二面機制：① 資料層支援「面試輪次」（如 round: 1 或 2）；② 科助可檢視各廠商「一面已排／二面已排／已完成」統計；③ 必要時科助可代為新增/修改面試時段（權限可選）。 |
| **面試結果彙整** | 廠商可標記「已完成面試」。 | 科助可檢視「已排程／已完成」統計，或匯出面試名單與完成狀態，供後續媒合參考。 |
| **通知與公告** | 廠商可發面試通知。 | 科助可發「實習面試提醒」或「二面公告」等系統公告，對象為學生或特定廠商之應徵學生。 |

---

## 三、學生 — 實習媒合機制與二面機制

### 3.1 實習媒合機制（學生）

| 操作 | 現況 | 建議規劃 |
|------|------|----------|
| **填寫志願序** | 已有填寫頁；截止後可自動 submitted→approved。 | 截止後改為唯讀；顯示「已送交」「已審核」狀態；若有「錄取為第 N 志願」可於結果頁顯示。 |
| **查看錄取結果** | 已有「我的實習成果」「學生媒合結果」等頁，可看錄取公司/職缺。 | 新流程下：僅在科助「確認即公告」後才顯示正式錄取；公告前可顯示「媒合處理中」或隱藏結果。 |
| **媒合成功通知** | 系統可發通知。 | 科助公告後，學生收到「媒合成功」通知，點擊可進入「我的實習成果」查看錄取公司、職缺、指導老師、「錄取為第 N 志願」（若有）。 |
| **備取/未錄取** | 多為「已錄取」或無紀錄。 | 若支援備取：學生端可顯示「備取於 OO 公司 OO 職缺」；未錄取者可顯示「本次未錄取」或僅不顯示錄取區塊。 |

### 3.2 二面機制（學生）

| 操作 | 現況 | 建議規劃 |
|------|------|----------|
| **查看面試行事曆** | 已有 `interview_schedule` 行事曆頁。 | 學生可檢視「我的面試」：依志願序對應之公司/職缺，顯示已排程的一面、二面時間與地點（若有）。 |
| **一面/二面區分** | 目前未區分輪次。 | 若支援二面：學生端顯示「第一輪面試」「第二輪面試」標籤與時間；二面僅在廠商排程後顯示。 |
| **面試通知** | 廠商可發通知。 | 學生收到面試通知（一面/二面）後，可於通知中心或行事曆查看詳情並確認知悉。 |
| **請假/改期** | 若無。 | 可選功能：學生對已排程面試提出「請假或改期」申請，由廠商或科助審核（視需求再細化）。 |

---

## 四、廠商 — 實習媒合機制與二面機制

### 4.1 實習媒合機制（廠商）

| 操作 | 現況 | 建議規劃 |
|------|------|----------|
| **媒合排序** | 已有正取 1、2…與候補勾選，存至 `vendor_preference_history`。 | 維持；可確認「媒合排序」頁即為「查看所有應徵學生」且操作動線清楚。 |
| **媒合確認（正式送出）** | 目前「確認媒合結果」會直接呼叫 `record_admission` 寫入錄取。 | 改為：① 點「媒合確認」→ 彈出彙整視窗（正取含順序 + 備取名單）；② 廠商點「正式送出」→ 僅將狀態改為「已送交科助確認」，不寫入錄取；③ 顯示「已送交，待主任核定與科助公告」。 |
| **查看送交狀態** | 無。 | 廠商可查看「本學期媒合狀態」：已送交／主任已核定／科助已公告；公告後可看到最終正取/遞補名單與錄取結果。 |
| **媒合成功通知** | 可發通知。 | 科助公告後，廠商收到「媒合結果已公告」通知，可前往「媒合結果」頁查看最終名單。 |

### 4.2 二面機制（廠商）

| 操作 | 現況 | 建議規劃 |
|------|------|----------|
| **面試排程** | 已有 `schedule_interviews`、`all_interview_schedules`、`mark_interview_completed`。 | 維持；若需二面：支援「第一輪面試」「第二輪面試」兩種排程，可依職缺/學生分別排程一面與二面時間。 |
| **一面/二面區分** | 目前未區分輪次。 | 排程時可選「一面」或「二面」；行事曆與列表依輪次顯示；標記完成時可選「一面完成」「二面完成」。 |
| **面試通知** | 廠商可發送面試通知給學生。 | 排程一面/二面後，可一鍵發送「一面通知」「二面通知」給對應學生（沿用現有通知或 Email）。 |
| **面試結果與正取名單** | 面試狀態有 not yet / in interview / done。 | 廠商可依「一面完成」「二面完成」篩選學生，作為正取/備取名單參考；與媒合排序流程銜接（先面試、再排序、再正式送出）。 |

---

## 五、角色與流程對照總表

| 角色 | 學期管理 | 實習媒合機制 | 二面機制 |
|------|----------|--------------|----------|
| **管理員** | 學期 CRUD、立即/預約切換、切換前檢查與摘要、刪除前關聯檢查、自動切換日誌。 | 一般不直接操作媒合；可檢視統計或日誌（依需求）。 | 一般不直接操作面試；可檢視全系統面試統計（依需求）。 |
| **科助** | 同管理員（若權限開放）；或僅檢視學期與日誌。 | 檢視「待科助公告」名單 → 「確認即公告」→ 寫入錄取並發通知；媒合結果匯出。 | 檢視全系統面試排程／一面二面統計；必要時代為排程或發公告。 |
| **學生** | 僅檢視當前學期（若開放）。 | 填寫志願序（截止後唯讀）→ 科助公告後查看錄取結果與「第 N 志願」；接收媒合成功通知。 | 查看「我的面試」行事曆；接收一面/二面通知；可選請假/改期申請。 |
| **廠商** | 不涉及。 | 媒合排序（正取/備取）→ 媒合確認彈出彙整 → 正式送出（送交科助）→ 科助公告後查看最終名單與通知。 | 排程一面/二面、發送面試通知、標記完成；依面試結果進行媒合排序。 |

---

## 六、建議實作優先順序（依角色）

1. **管理員（學期）**：切換前檢查 API + 學期管理頁確認流程 → 切換影響摘要 → 刪除前關聯檢查 → 自動切換日誌。
2. **廠商（媒合）**：正式送出改為只改狀態（第一波）→ 媒合確認彈出彙整與送交狀態顯示。
3. **主任（媒合）**：衝突偵測 + 媒合核定頁（檢視 → 衝突處理 → 空缺與備取遞補 → 核定發布）。
4. **科助（媒合）**：待科助公告名單 + 「確認即公告」按鈕與 API + 通知與結果頁更新。
5. **學生（媒合）**：公告後才顯示正式錄取、「錄取為第 N 志願」、媒合成功通知。
6. **二面機制**：若需區分一面/二面，則在面試排程與行事曆增加「輪次」欄位與篩選；科助/學生/廠商依上表操作規劃擴充。

---

*本文件可與 `媒合機制缺口分析.md`、`系統功能統整.md` 對照使用；實作時請依實際權限與流程微調。*
