<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <title>å¾Œå°ç®¡ç† | å¯¦ç¿’ Q&A ç®¡ç†</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body {
      background: #f5f6fa;
      font-family: "Noto Sans TC", sans-serif;
    }

    header {
      background: #0454a3;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.4rem;
    }

    .table th {
      background: #eef3ff;
    }
  </style>
</head>

<body>
  <header>å¯¦ç¿’ Q&A ç®¡ç†å¾Œå°</header>

  <div class="container mt-4">

    <!-- ä¸Šæ–¹æ“ä½œåˆ— -->
    <div class="d-flex justify-content-between mb-3">
      <h4>å•ç­”åˆ—è¡¨</h4>
      <button class="btn btn-primary" onclick="openAddModal()">
        â• æ–°å¢ Q&A
      </button>
    </div>

    <!-- è³‡æ–™è¡¨ -->
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th style="width: 60px">ID</th>
          <th style="width: 250px">å•é¡Œ</th>
          <th>ç­”æ¡ˆ</th>
          <th style="width: 120px">æ’åº</th>
          <th style="width: 160px">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="qa-table"></tbody>
    </table>
  </div>

  <!-- æ–°å¢/ç·¨è¼¯ Modal -->
  <div class="modal fade" id="qaModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="qaModalLabel">æ–°å¢ Q&A</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" id="qa-id">

          <div class="mb-3">
            <label class="form-label">å•é¡Œ</label>
            <input id="qa-question" type="text" class="form-control" placeholder="è¼¸å…¥å•é¡Œ">
          </div>

          <div class="mb-3">
            <label class="form-label">ç­”æ¡ˆï¼ˆæ”¯æ´ HTMLï¼‰</label>
            <textarea id="qa-answer" class="form-control" rows="5" placeholder="è¼¸å…¥ç­”æ¡ˆ"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">æ’åºï¼ˆæ„ˆå°æ„ˆå‰é¢ï¼‰</label>
            <input id="qa-sort" type="number" class="form-control" value="0">
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button class="btn btn-success" onclick="saveQA()">ğŸ’¾ å„²å­˜</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const qaModal = new bootstrap.Modal(document.getElementById("qaModal"));

    // è®€å– Q&A åˆ—è¡¨
    async function loadQA() {
      const res = await fetch("/api/qa/list");
      const json = await res.json();

      if (!json.success) {
        alert("è³‡æ–™è¼‰å…¥å¤±æ•—");
        return;
      }

      const tbody = document.getElementById("qa-table");
      tbody.innerHTML = json.data.map(item => `
        <tr>
          <td>${item.id}</td>
          <td>${item.question}</td>
          <td>${item.answer}</td>
          <td>${item.sort_order}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="openEditModal(${item.id}, '${encodeURIComponent(item.question)}', '${encodeURIComponent(item.answer)}', ${item.sort_order})">ç·¨è¼¯</button>
            <button class="btn btn-sm btn-danger" onclick="deleteQA(${item.id})">åˆªé™¤</button>
          </td>
        </tr>
      `).join("");
    }

    // é–‹å•Ÿæ–°å¢ Modal
    function openAddModal() {
      document.getElementById("qaModalLabel").textContent = "æ–°å¢ Q&A";
      document.getElementById("qa-id").value = "";
      document.getElementById("qa-question").value = "";
      document.getElementById("qa-answer").value = "";
      document.getElementById("qa-sort").value = "0";
      qaModal.show();
    }

    // é–‹å•Ÿç·¨è¼¯ Modal
    function openEditModal(id, question, answer, sort) {
      document.getElementById("qaModalLabel").textContent = "ç·¨è¼¯ Q&A";
      document.getElementById("qa-id").value = id;
      document.getElementById("qa-question").value = decodeURIComponent(question);
      document.getElementById("qa-answer").value = decodeURIComponent(answer);
      document.getElementById("qa-sort").value = sort;
      qaModal.show();
    }

    // å„²å­˜ï¼ˆæ–°å¢ / ç·¨è¼¯ å…±ç”¨ï¼‰
    async function saveQA() {
      const id = document.getElementById("qa-id").value;
      const question = document.getElementById("qa-question").value.trim();
      const answer = document.getElementById("qa-answer").value.trim();
      const sort = document.getElementById("qa-sort").value;

      if (!question || !answer) {
        alert("å•é¡Œèˆ‡ç­”æ¡ˆä¸å¾—ç‚ºç©ºï¼");
        return;
      }

      const payload = { question, answer, sort_order: sort };

      let url = "/api/qa/add";
      let method = "POST";

      if (id) {
        url = `/api/qa/update/${id}`;
        method = "PUT";
      }

      const res = await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const json = await res.json();

      if (json.success) {
        alert("å„²å­˜æˆåŠŸï¼");
        qaModal.hide();
        loadQA();
      } else {
        alert(json.message || "å„²å­˜å¤±æ•—");
      }
    }

    // åˆªé™¤
    async function deleteQA(id) {
      if (!confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ Q&A å—ï¼Ÿ")) return;

      const res = await fetch(`/api/qa/delete/${id}`, { method: "DELETE" });
      const json = await res.json();

      if (json.success) {
        alert("åˆªé™¤æˆåŠŸï¼");
        loadQA();
      } else {
        alert("åˆªé™¤å¤±æ•—");
      }
    }

    // åˆå§‹åŒ–ï¼šè¼‰å…¥è³‡æ–™
    loadQA();
  </script>
</body>

</html>
